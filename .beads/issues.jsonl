{"id":"pg-sourcerer-01h","title":"Implement RLS-driven field variant generation","description":"Use IR field permissions to determine which Model variants include each field.\n\nMapping:\n- canSelect: true → include in select, json\n- canInsert: true → include in insert, jsonCreate  \n- canUpdate: true → include in update, jsonUpdate\n\nUse Model.Field({...}) to specify per-variant schemas based on permissions.\n\nEdge cases:\n- Field with no permissions → skip entirely\n- Entity with !canSelect → still generate if canInsert (write-only entity)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T22:12:18.24983469-06:00","updated_at":"2026-01-06T22:35:02.039226524-06:00","closed_at":"2026-01-06T22:35:02.039226524-06:00","close_reason":"Implemented Model.FieldExcept for RLS-driven variant exclusion. Fields without insert/update permissions are excluded from those variants using Model.FieldExcept.","labels":["effect-model","rls"]}
{"id":"pg-sourcerer-0m3","title":"Commit effect-model plugin","description":"Once tests pass and output is clean, commit the effect-model plugin files","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T22:46:16.555145304-06:00","updated_at":"2026-01-06T22:56:53.933178736-06:00","closed_at":"2026-01-06T22:56:53.933178736-06:00","close_reason":"Committed in 82177c9","labels":["effect-model","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-0m3","depends_on_id":"pg-sourcerer-j3f","type":"blocks","created_at":"2026-01-06T22:46:20.137320796-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-0ot","title":"Add CHANGELOG.md","description":"Create a CHANGELOG.md following Keep a Changelog format. Start with version 0.1.0 documenting initial features:\n- Plugin system with capability resolution\n- TypeScript types plugin\n- Zod schemas plugin  \n- Effect Model plugin\n- Smart tags support\n- CLI with generate command","notes":"Replaced with release-please automation - generates CHANGELOG.md automatically from conventional commits","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T10:55:44.492026914-06:00","updated_at":"2026-01-07T11:13:56.267516367-06:00","closed_at":"2026-01-07T11:13:56.267516367-06:00","close_reason":"Set up release-please: workflow creates release PRs from conventional commits, auto-generates CHANGELOG.md, triggers npm publish on merge. Replaced manual release.yml.","labels":["docs","p1","publish"],"dependencies":[{"issue_id":"pg-sourcerer-0ot","depends_on_id":"pg-sourcerer-p1l","type":"parent-child","created_at":"2026-01-07T10:57:11.522621729-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-0t2","title":"Kysely Plugin Suite","description":"Implement Kysely-specific code generation plugins.\n\nPlugins:\n1. Kysely Types Plugin - Generate Kysely-compatible type definitions (Generated\u003cT\u003e, Selectable, Insertable, Updateable)\n2. Kysely Queries Plugin - Generate type-safe query builders\n\nThese plugins enable type-safe database access via Kysely ORM.","status":"open","priority":4,"issue_type":"epic","created_at":"2026-01-06T14:42:56.796172635-06:00","updated_at":"2026-01-07T16:42:03.053534223-06:00","labels":["rewrite"]}
{"id":"pg-sourcerer-0tn","title":"Refactor types plugin to use Conjure DSL","description":"Replace raw recast builder calls with conjure DSL in the types plugin. Should simplify code and remove need for local cast helpers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:32:38.57762583-06:00","updated_at":"2026-01-06T15:34:57.850266692-06:00","closed_at":"2026-01-06T15:34:57.850266692-06:00","close_reason":"Refactored types.ts to use conjure DSL. Removed local cast helpers, now uses conjure.ts.* for type nodes, conjure.print/program for output. All 355 tests pass.","labels":["conjure","rewrite"]}
{"id":"pg-sourcerer-0un","title":"Fix packages/lib/prompt.ts and packages/example/scripts lint errors","description":"ESLint errors in example scripts (dbEnsure.ts, dbSetup.ts, generateEnvFile.ts) and lib/prompt.ts. These are copied from another Effect project and need cleanup. Issues include: recursive confirm() bug, missing Bun global types, npm-run-all missing types, various unsafe access patterns.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T10:58:42.216483865-06:00","updated_at":"2026-01-07T10:44:37.768830059-06:00","closed_at":"2026-01-07T10:44:37.768830059-06:00","close_reason":"Fixed lint error in config-loader.ts (S.Any assignment)","labels":["example"]}
{"id":"pg-sourcerer-102","title":"sql-queries: Fix field types using field.name instead of actual TS type","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-07T16:11:20.519809481-06:00","updated_at":"2026-01-07T19:59:16.126204938-06:00"}
{"id":"pg-sourcerer-187","title":"Create definePlugin helper for simple plugins","description":"Create `definePlugin` helper for writing simple plugins without Effect knowledge.\n\n```typescript\ninterface SimplePluginContext {\n  readonly ir: SemanticIR\n  readonly inflection: CoreInflection\n  readonly symbols: SymbolRegistry\n  readonly typeHints: TypeHintRegistry\n  readonly emit: (path: string, content: string) =\u003e void\n  readonly appendEmit: (path: string, content: string) =\u003e void\n  readonly getArtifact: (cap: CapabilityKey) =\u003e Artifact | undefined\n  readonly setArtifact: (cap: CapabilityKey, data: unknown) =\u003e void\n  readonly log: { debug, info, warn }\n}\n\ninterface SimplePluginDef\u003cTConfig\u003e {\n  name: string\n  requires?: CapabilityKey[]\n  provides: CapabilityKey[]\n  configSchema: S.Schema\u003cTConfig\u003e\n  inflection: PluginInflection\n  run: (ctx: SimplePluginContext, config: TConfig) =\u003e void | Promise\u003cvoid\u003e\n}\n\nfunction definePlugin\u003cTConfig\u003e(def: SimplePluginDef\u003cTConfig\u003e): Plugin\u003cTConfig\u003e\n```\n\nThe helper:\n1. Yields all services from context\n2. Constructs the SimplePluginContext object\n3. Calls the user's run function\n4. Wraps sync/async in Effect.tryPromise or Effect.sync\n5. Catches errors and wraps in PluginExecutionFailed","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:28:13.519563144-06:00","updated_at":"2026-01-06T11:40:08.13409562-06:00","closed_at":"2026-01-06T11:40:08.13409562-06:00","close_reason":"Created definePlugin helper in src/services/plugin.ts. Provides simple API for plugin authors: `run: (ctx, config) =\u003e void | Promise\u003cvoid\u003e`. The helper yields all services from Effect context, builds a SimplePluginContext object, and handles sync/async execution with proper error wrapping.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-187","depends_on_id":"pg-sourcerer-dpp","type":"blocks","created_at":"2026-01-06T11:28:16.513026514-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-1fd","title":"sql-queries: Add trigram search function generation","description":"Generate search functions for GIN trigram indexes:\n- searchUsersByUsername(pattern) for ILIKE/similarity queries\n- Proper parameterization to prevent injection\n- Configurable limit defaults\n\nDepends on QueryKind discriminator being in place.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-07T16:30:46.197131333-06:00","updated_at":"2026-01-07T19:59:21.448502869-06:00","dependencies":[{"issue_id":"pg-sourcerer-1fd","depends_on_id":"pg-sourcerer-ues","type":"blocks","created_at":"2026-01-07T16:30:50.130560281-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-1n1","title":"Add Unit Tests for Emissions Buffer","description":"EmissionBuffer has no dedicated tests. Should test:\n\n- `emit()` - basic file emission\n- `emit()` - same file, same plugin (overwrites)\n- `emit()` - same file, different plugin (conflict on validate)\n- `appendEmit()` - appends to existing\n- `appendEmit()` - different plugin tries to append (error)\n- `validate()` - returns clean for no conflicts\n- `validate()` - fails with EmitConflict for conflicts\n- `clear()` - empties the buffer\n- `getAll()` - returns all entries","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:45:59.773722614-06:00","updated_at":"2026-01-06T12:02:25.674672702-06:00","closed_at":"2026-01-06T12:02:25.674672702-06:00","close_reason":"42 inflection tests + 16 emissions tests added, all passing","labels":["core","rewrite","testing"]}
{"id":"pg-sourcerer-1tr","title":"config-loader: Refactor null check to use Option pattern","description":"Refactor config-loader null check to use `Option.fromNullable` and `Option.filter` pattern.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T16:52:13.352450142-06:00","updated_at":"2026-01-07T18:42:36.469150652-06:00","closed_at":"2026-01-07T18:42:36.469150652-06:00","close_reason":"Superseded by pg-sourcerer-ug3 - larger Option\u003cT\u003e refactor"}
{"id":"pg-sourcerer-2lv","title":"sql-queries: Add full-text search function generation","description":"Generate search functions for tsvector GIST/GIN indexes:\n- searchPosts(query) using plainto_tsquery or websearch_to_tsquery\n- Support for ranking results\n- Configurable limit defaults\n\nDepends on QueryKind discriminator being in place.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-07T16:30:46.197214417-06:00","updated_at":"2026-01-07T19:59:21.43064794-06:00","dependencies":[{"issue_id":"pg-sourcerer-2lv","depends_on_id":"pg-sourcerer-ues","type":"blocks","created_at":"2026-01-07T16:30:50.161555741-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-2nj","title":"Config Loader Service","description":"Load and validate pgsourcerer.config.ts:\n\n- Config file discovery (CLI flag, then pgsourcerer.config.{ts,js,mjs})\n- Parse with Effect Schema\n- Validate plugin configs individually\n- Resolve environment variables\n\nResearch needed: Effect.Config vs lilconfig vs Bun native import.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:23:25.921417722-06:00","updated_at":"2026-01-05T21:40:26.237083116-06:00","closed_at":"2026-01-05T21:40:26.237083116-06:00","close_reason":"Config Loader Service complete: lilconfig integration with Effect wrapper, Schema validation, proper error handling. Also created introspection fixture from example database for future testing.","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-2nj","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:23:25.922938443-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-2pv","title":"Call emissions.validate() After Plugin Execution","description":"`EmissionBuffer.validate()` exists to detect conflicts (same file emitted by different plugins), but nothing ever calls it:\n\n```typescript\n// emissions.ts - validate() defined\nreadonly validate: () =\u003e Effect.Effect\u003cvoid, EmitConflict\u003e\n\n// plugin-runner.ts - never called!\n```\n\nAfter all plugins execute, should call `emissions.validate()` to catch conflicts before writing files.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:45:47.572794008-06:00","updated_at":"2026-01-06T10:09:41.33706227-06:00","closed_at":"2026-01-06T10:09:41.33706227-06:00","close_reason":"run() now automatically validates emissions and symbols after plugin execution. Fails with EmitConflict or SymbolConflict errors.","labels":["core","rewrite"]}
{"id":"pg-sourcerer-2r3","title":"File Writer Service","description":"Write buffered emissions to disk:\n\n- Take EmissionBuffer contents after all plugins complete\n- Add generated file header with timestamp\n- Create directories as needed\n- Write files (overwrite existing)\n- Support dry-run mode (show what would be written)\n\nUses @effect/platform FileSystem service.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:23:20.082752601-06:00","updated_at":"2026-01-05T20:00:07.060720919-06:00","closed_at":"2026-01-05T20:00:07.060720919-06:00","close_reason":"Implemented FileWriter service using @effect/platform FileSystem. Features: writes emissions to disk with auto-generated header, creates directories recursively, supports dry-run mode, parallel file writes with configurable concurrency. Full test coverage with real filesystem operations.","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-2r3","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:23:20.084147028-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-37k","title":"Update FileNameContext for unified Entity","description":"Simplify FileNameContext to use pgName instead of tableName. Ensure it works for all entity kinds. Update PluginInflection if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:17.701406398-06:00","updated_at":"2026-01-07T14:47:15.452974258-06:00","closed_at":"2026-01-07T14:47:15.452974258-06:00","close_reason":"Updated FileNameContext.tableName to pgName for consistency with Entity.pgName","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-37k","depends_on_id":"pg-sourcerer-6w8","type":"blocks","created_at":"2026-01-07T14:23:26.001672499-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-395","title":"Update plugins to use function-based inflectionDefaults","description":"Update types.ts, zod.ts, effect-model.ts plugins to use function-based inflectionDefaults instead of transform chain arrays.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T10:03:08.207964812-06:00","updated_at":"2026-01-07T10:10:42.437562616-06:00","closed_at":"2026-01-07T10:10:42.437562616-06:00","close_reason":"Merged into pg-sourcerer-4ia","dependencies":[{"issue_id":"pg-sourcerer-395","depends_on_id":"pg-sourcerer-4ia","type":"blocks","created_at":"2026-01-07T10:03:15.418692606-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-395","depends_on_id":"pg-sourcerer-knj","type":"blocks","created_at":"2026-01-07T10:03:15.441544261-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-3bq","title":"Implement query plugin - generate typed query functions","description":"Generate typed query functions that execute raw SQL with type-safe wrappers.\n\n## Plugin Config\n- provides: [\"queries:sql\"]\n- requires: [\"types\"]\n- Returns Promise\u003cT\u003e (not Effect)\n\n## Query Functions to Generate\n\n### Per Entity (based on indexes):\n- **Primary key**: `getUserById(id: string): Promise\u003cUser | null\u003e`\n- **Unique indexes**: `getUserByUsername(username: string): Promise\u003cUser | null\u003e`\n- **Non-unique indexes**: `getPostsByUserId(userId: string): Promise\u003cPost[]\u003e`\n- **Composite indexes**: `getVoteByPostIdAndUserId(postId: number, userId: string): Promise\u003cPostVote | null\u003e`\n\n### Generated File Structure:\n```\nqueries/\n  users.ts      # getUserById, getUserByUsername, listUsers, etc.\n  posts.ts      # getPostById, getPostsByUserId, listPosts, etc.\n  index.ts      # re-exports\n```\n\n## Implementation Notes\n- Import Row types from types plugin via symbol registry\n- Generate parameterized SQL ($1, $2, etc.)\n- Handle nullable returns (single) vs arrays (multi)\n- Skip expression-only indexes (no column names to use)\n- Skip partial indexes for now (predicate parsing is complex)\n\n## Acceptance Criteria\n- [ ] Plugin scaffolding with definePlugin\n- [ ] Primary key lookups work\n- [ ] Unique index lookups work  \n- [ ] Non-unique index lookups return arrays\n- [ ] Composite key lookups work\n- [ ] Imports Row types from types plugin\n- [ ] SQL is parameterized (no injection)","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-07T11:36:56.856496644-06:00","updated_at":"2026-01-07T19:59:17.109815144-06:00","dependencies":[{"issue_id":"pg-sourcerer-3bq","depends_on_id":"pg-sourcerer-prh","type":"blocks","created_at":"2026-01-07T11:37:03.367161703-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-3bq","depends_on_id":"pg-sourcerer-t1b","type":"blocks","created_at":"2026-01-07T11:41:45.343563267-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-3bq","depends_on_id":"pg-sourcerer-y9v","type":"blocks","created_at":"2026-01-07T11:44:29.793819003-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-3c2","title":"Configure package.json exports for npm publication","description":"Update package.json with proper exports configuration:\n- Change `main` from `src/index.ts` to `dist/index.js`\n- Add `types` field pointing to `dist/index.d.ts`\n- Add `exports` field for ESM\n- Add `files` field to control what gets published (dist/, README, LICENSE)\n- Add `prepublishOnly` script to ensure build runs before publish","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:55:38.367767617-06:00","updated_at":"2026-01-07T11:00:35.002153367-06:00","closed_at":"2026-01-07T11:00:35.002153367-06:00","close_reason":"Updated package.json with: main→dist/index.js, types field, exports map, bin→dist/cli.js, files array, keywords, repository, license, author. Bumped version to 0.1.0.","labels":["p0","publish"],"dependencies":[{"issue_id":"pg-sourcerer-3c2","depends_on_id":"pg-sourcerer-p1l","type":"parent-child","created_at":"2026-01-07T10:57:08.346457137-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-3d9","title":"sql-queries: Missing await on sql calls","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-07T16:11:24.977745311-06:00","updated_at":"2026-01-07T19:59:16.053441564-06:00"}
{"id":"pg-sourcerer-3eo","title":"pg-types: Refactor findEnumByPgName to use Effect patterns","description":"Refactor `findEnumByPgName` to use Effect's `Arr.findFirst` and `Option.map` instead of imperative for loop with early return.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:52:11.37795329-06:00","updated_at":"2026-01-07T18:42:35.193494147-06:00","closed_at":"2026-01-07T18:42:35.193494147-06:00","close_reason":"Superseded by pg-sourcerer-ug3 - larger Option\u003cT\u003e refactor"}
{"id":"pg-sourcerer-3ii","title":"Add tests for query plugin","description":"Comprehensive tests for the query plugin.\n\n## Test Categories\n\n### Unit Tests\n- Index → query function mapping logic\n- SQL generation (parameterization, escaping)\n- Function naming inflection\n- Composite key handling\n\n### Integration Tests (against example DB)\n- Primary key lookups return correct row\n- Unique lookups return correct row  \n- Non-unique lookups return array\n- FK lookups return related rows\n- Pagination works (limit, offset, orderBy)\n- Count returns correct number\n- Exists returns boolean\n- Missing row returns null (not throws)\n\n### Edge Cases\n- Tables with no indexes (only PK)\n- Composite primary keys\n- Self-referential FKs\n- Tables with many indexes (dedup?)\n- Reserved word column names","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:36:57.695517132-06:00","updated_at":"2026-01-07T11:44:31.12859824-06:00","closed_at":"2026-01-07T11:44:31.12859824-06:00","close_reason":"Superseded by test-first tasks (afn, y9v) integrated into the workflow","dependencies":[{"issue_id":"pg-sourcerer-3ii","depends_on_id":"pg-sourcerer-3bq","type":"blocks","created_at":"2026-01-07T11:37:04.052953148-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-3ii","depends_on_id":"pg-sourcerer-jpi","type":"blocks","created_at":"2026-01-07T11:42:06.150789879-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-3p5","title":"Refactor Entity as discriminated union in semantic-ir.ts","description":"Create EntityBase, TableEntity, EnumEntity types. Entity becomes union. Add pgName field (replaces tableName). Remove separate EnumDef type. Update SemanticIR to remove enums map. Update SemanticIRBuilder and freezeIR.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:08.942302889-06:00","updated_at":"2026-01-07T14:26:14.413700984-06:00","closed_at":"2026-01-07T14:26:14.413700984-06:00","close_reason":"Created EntityBase, TableEntity, EnumEntity. Entity is now a union type. Added pgName field. Removed separate enums map from SemanticIR. Added type guards isTableEntity() and isEnumEntity(). Added helper functions getTableEntities() and getEnumEntities().","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-3p5","depends_on_id":"pg-sourcerer-6fo","type":"blocks","created_at":"2026-01-07T14:23:08.948476036-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-3pg","title":"Fix generated file imports: @sorcery/db path not resolving","description":"ESLint shows ~185 errors in packages/example/generated/ - all are 'unsafe' errors because the import from @sorcery/db is not resolving correctly. The generator is emitting incorrect import paths.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T10:31:44.957198415-06:00","updated_at":"2026-01-06T11:53:05.080661707-06:00","closed_at":"2026-01-06T11:53:05.080661707-06:00","close_reason":"Issue is resolved - generated files now import from @effect/sql and effect correctly. ESLint reports no errors in packages/example/generated/.","labels":["rewrite"]}
{"id":"pg-sourcerer-3si","title":"Refactor ir-builder.ts getTypeName to use Option\u003cPgType\u003e","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T19:09:28.430131763-06:00","updated_at":"2026-01-07T19:09:28.430131763-06:00"}
{"id":"pg-sourcerer-4h9","title":"Simplify effect-model plugin output","description":"The current effect-model plugin generates overly complex nested code like Model.FieldExcept(...)(Model.Generated(...)) when simpler patterns exist. Refactor to use Model.Generated, Model.Sensitive, Model.DateTimeInsertFromDate etc directly instead of manually composing FieldExcept.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T22:46:03.754536125-06:00","updated_at":"2026-01-06T22:55:47.338983628-06:00","closed_at":"2026-01-06T22:55:47.338983628-06:00","close_reason":"Simplified plugin: removed FieldExcept nesting, use Model.Generated/Sensitive/DateTimeInsertFromDate directly. Also fixed shared emptySmartTags bug causing tag mutations to leak between fields.","labels":["effect-model","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-4h9","depends_on_id":"pg-sourcerer-7sa","type":"blocks","created_at":"2026-01-06T22:46:20.162500473-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-4ia","title":"Refactor InflectionConfig to use string→string functions","description":"Refactor InflectionConfig from TransformChain string arrays to plain string→string functions. This includes:\n\n1. Change InflectionConfig to use optional functions: `entityName?: (name: string) =\u003e string`\n2. Update createInflection() to accept function-based config\n3. Fix composeInflection to properly compose functions: `(name) =\u003e user(plugin(name))`\n4. Update plugins to use function-based inflectionDefaults\n5. Export helper functions (singularize, pluralize, camelCase, etc.) for user composition\n6. Complete the pluginInflection work from pg-sourcerer-fav (already wired to context)\n7. Fix failing tests\n\nMerged from pg-sourcerer-fav which added FileNameContext and pluginInflection to SimplePluginContext.","notes":"## Current State (from fav)\n\n### Completed\n- FileNameContext type added to plugin.ts\n- PluginInflection.outputFile signature updated\n- pluginInflection added to SimplePluginContext\n- All plugins updated to use ctx.pluginInflection.outputFile(fileNameCtx)\n\n### Broken\n- composeInflection doesn't properly compose plugin defaults with user config\n- Tests failing: plugin-runner.test.ts (missing Inflection), e2e-config.test.ts (wrong filenames)\n\n### Root Cause\nThe current TransformChain approach makes composition awkward. composeInflection only applies plugin chain, ignores base inflection's chain.\n\n## Plan\n1. Change InflectionConfig from TransformChain to functions\n2. Update composeInflection to compose functions properly\n3. Export helper functions for users\n4. Fix tests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:03:03.292086241-06:00","updated_at":"2026-01-07T10:32:19.739406904-06:00","closed_at":"2026-01-07T10:32:19.739406904-06:00","close_reason":"Completed: Refactored InflectionConfig from TransformChain string arrays to plain TransformFn functions. Added inflect helper object with camelCase, pascalCase, singularize, etc. Updated all tests and example config to use new function-based API. All 445 tests passing.","dependencies":[{"issue_id":"pg-sourcerer-4ia","depends_on_id":"pg-sourcerer-fav","type":"blocks","created_at":"2026-01-07T10:07:04.59422721-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-4kh","title":"Export inflection helper functions","description":"Export singularize, pluralize, camelCase, pascalCase, snakeCase, etc. from the package so users can compose them in their config.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T10:03:06.668245492-06:00","updated_at":"2026-01-07T10:10:43.119373423-06:00","closed_at":"2026-01-07T10:10:43.119373423-06:00","close_reason":"Merged into pg-sourcerer-4ia","dependencies":[{"issue_id":"pg-sourcerer-4kh","depends_on_id":"pg-sourcerer-4ia","type":"blocks","created_at":"2026-01-07T10:03:15.392231381-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-4zj","title":"Verify compiled output works for Node.js consumers","description":"After adding build script and exports config, verify the package works when consumed:\n- Build the package\n- Create a simple test project that imports from the built package\n- Ensure types resolve correctly\n- Ensure runtime works (not just types)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:55:50.511813633-06:00","updated_at":"2026-01-07T10:56:01.675051784-06:00","closed_at":"2026-01-07T10:56:01.675051784-06:00","close_reason":"Duplicate - see pg-sourcerer-78f which has proper dependencies","labels":["p0","publish"]}
{"id":"pg-sourcerer-5n0","title":"Add FunctionEntity to IR","description":"Add FunctionEntity to the Entity discriminated union for PostgreSQL stored functions/procedures.\n\n## Fields from PgProc\n\nBased on old introspection.mjs (commit e2ab591):\n- `proc.pronamespace` - schema OID\n- `proc.proname` - function name  \n- `proc.getReturnType()` - return type\n- `proc.provolatile` - 'i' (immutable), 's' (stable), 'v' (volatile)\n- `proc.proargnames` - argument names (may be null/sparse)\n- `proc.getArguments()` - array of { type, hasDefault }\n- Permissions via `entityPermissions()` → { canExecute: boolean }\n\n## Proposed Types\n\n```typescript\nexport type Volatility = \"immutable\" | \"stable\" | \"volatile\"\n\nexport interface FunctionArg {\n  readonly name: string\n  readonly typeName: string\n  readonly hasDefault: boolean\n  readonly mode: \"in\" | \"out\" | \"inout\" | \"variadic\"\n}\n\nexport interface FunctionEntity extends EntityBase {\n  readonly kind: \"function\"\n  readonly pgProc: PgProc\n  readonly returnTypeName: string\n  readonly returnsSet: boolean\n  readonly args: readonly FunctionArg[]\n  readonly outArgs: readonly FunctionArg[]\n  readonly volatility: Volatility\n  readonly isStrict: boolean\n  readonly canExecute: boolean\n}\n```\n\n## Implementation\n\n1. Update EntityKind to include \"function\"\n2. Add FunctionEntity interface to semantic-ir.ts\n3. Add isFunctionEntity() type guard and getFunctionEntities() helper\n4. Add filterFunctions() and buildFunction() to ir-builder.ts\n5. Update build() to include functions in IR\n6. Export new types from index.ts\n7. Add integration tests","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-07T15:09:25.828788626-06:00","updated_at":"2026-01-07T15:29:49.134698579-06:00","closed_at":"2026-01-07T15:29:49.134698579-06:00","close_reason":"Implemented FunctionEntity with Volatility, FunctionArg types; updated EntityKind and Entity union; added isFunctionEntity type guard and getFunctionEntities helper; added filterFunctions, buildFunction, getTypeName to ir-builder; added functionName inflection method; all 498 tests pass"}
{"id":"pg-sourcerer-5vx","title":"Add emitAst() to plugin context for AST-based emissions","description":"Add emitAst(path, ast) alongside emit(path, string) so plugins can emit AST nodes directly. The plugin runner handles serialization, enabling future AST-level operations like import merging and consistent formatting.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:54:17.009310926-06:00","updated_at":"2026-01-06T16:11:16.393335077-06:00","closed_at":"2026-01-06T16:11:16.393335077-06:00","close_reason":"Implemented emitAst() in EmissionBuffer and SimplePluginContext. Types and Zod plugins now use emitAst() with conjure DSL. All 355 tests pass. AST serialization happens in plugin runner after all plugins complete, enabling future AST-level operations like import merging.","labels":["conjure","rewrite"]}
{"id":"pg-sourcerer-682","title":"Refactor services to use Effect immutable collections","description":"Several services still use native Map/Set where MutableHashMap/MutableHashSet or HashMap/HashSet would be more idiomatic:\n\n- emissions.ts prependImports (local Map/Set)\n- symbols.ts registry (Map)\n- artifact-store.ts (Map)\n- types.ts plugin (Set/Map for tracking)\n\nLow priority - current code works fine, this is just for consistency.","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-07T14:01:42.837367421-06:00","updated_at":"2026-01-07T16:41:59.413769492-06:00","closed_at":"2026-01-07T16:40:49.95231581-06:00","close_reason":"Refactored symbols.ts and artifact-store.ts to use MutableHashMap from Effect instead of native Map"}
{"id":"pg-sourcerer-6a3","title":"Migrate types plugin to FileBuilder + exp.*","description":"Refactor types plugin to use new APIs:\n\n## Changes\n- Replace manual symbol registration with exp.* helpers\n- Replace ctx.emitAst() with ctx.file().ast().emit()\n- Replace hardcoded enum import strings with symbol refs\n- Use exp.interface() for entity interfaces\n- Use exp.typeAlias() for enum type aliases\n\n## Example\n```typescript\nconst enumStatements = [...ir.enums.values()].map(enumDef =\u003e\n  exp.typeAlias(\n    enumDef.name,\n    { capability: \"types\", entity: enumDef.name },\n    ts.union(...enumDef.values.map(v =\u003e ts.literal(v)))\n  )\n)\n\nctx.file(`${config.outputDir}/enums.ts`)\n  .header(\"// Auto-generated. Do not edit.\")\n  .ast(program(...enumStatements))\n  .emit()\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T17:46:19.895206284-06:00","updated_at":"2026-01-06T18:09:18.121785916-06:00","closed_at":"2026-01-06T18:09:18.121785916-06:00","close_reason":"Migrated types plugin to FileBuilder + exp.* API. Now uses ctx.file().header().import().ast().emit() pattern, exp.interface() for shape interfaces, exp.typeAlias() for enums, and symbol-based import refs instead of hardcoded strings.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-6a3","depends_on_id":"pg-sourcerer-9pr","type":"parent-child","created_at":"2026-01-06T17:46:37.612017704-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-6a3","depends_on_id":"pg-sourcerer-7yv","type":"blocks","created_at":"2026-01-06T17:46:47.455935467-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-6a3","depends_on_id":"pg-sourcerer-gmb","type":"blocks","created_at":"2026-01-06T17:46:49.953708738-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-6fc","title":"type-hints: Refactor merged hints for loop to Array.reduce","description":"Refactor getHintsImpl for...of with Object.assign to use Array.reduce","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T20:06:19.134822063-06:00","updated_at":"2026-01-07T20:06:58.444681819-06:00","closed_at":"2026-01-07T20:06:58.444681819-06:00","close_reason":"Refactored getHintsImpl: for...of with Object.assign → Array.reduce with spread operator"}
{"id":"pg-sourcerer-6fo","title":"Enums/domains/composites should follow same output rules as entities","description":"Unify Entity and EnumDef into a single discriminated union type. Enums become entities with kind: \"enum\", eliminating the separate ir.enums map. This enables enums to follow the same output/inflection rules as tables and views.","design":"## New Entity Structure (Discriminated Union)\n\n```typescript\n// Base fields shared by all entity kinds\ninterface EntityBase {\n  readonly name: string           // Inflected name\n  readonly pgName: string         // Original PG name (replaces tableName)\n  readonly schemaName: string\n  readonly tags: SmartTags\n}\n\n// Table/View entity\ninterface TableEntity extends EntityBase {\n  readonly kind: \"table\" | \"view\"\n  readonly pgClass: PgClass\n  readonly primaryKey?: PrimaryKey\n  readonly indexes: readonly IndexDef[]\n  readonly shapes: { row: Shape; insert?: Shape; update?: Shape; patch?: Shape }\n  readonly relations: readonly Relation[]\n  readonly permissions: EntityPermissions\n}\n\n// Enum entity\ninterface EnumEntity extends EntityBase {\n  readonly kind: \"enum\"\n  readonly pgType: PgType\n  readonly values: readonly string[]\n}\n\ntype Entity = TableEntity | EnumEntity\n```\n\n## Changes Required\n1. semantic-ir.ts - Restructure Entity as discriminated union\n2. ir-builder.ts - Add enums to entities map\n3. SemanticIR - Remove enums map\n4. FileNameContext - Simplify to work with unified Entity\n5. All plugins - Handle entity.kind discrimination\n6. Tests - Update fixtures","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-07T13:03:01.291531908-06:00","updated_at":"2026-01-07T14:47:17.563853936-06:00","closed_at":"2026-01-07T14:47:17.563853936-06:00","close_reason":"Completed: Enums now follow same output rules as entities. Each enum gets its own file via outputFile inflection. Entity is now a discriminated union with TableEntity and EnumEntity."}
{"id":"pg-sourcerer-6g1","title":"Add permission helper functions to ir-builder.ts","description":"Create helper functions to extract permissions from pg-introspection.\n\n**Import:**\n```typescript\nimport { entityPermissions } from \"pg-introspection\"\n```\n\n**Add `buildEntityPermissions` function:**\n```typescript\nfunction buildEntityPermissions(\n  introspection: Introspection,\n  pgClass: PgClass,\n  role: PgRoles\n): EntityPermissions {\n  const perms = entityPermissions(introspection, pgClass, role, true)\n  \n  let canSelect = perms.select ?? false\n  let canInsert = perms.insert ?? false\n  let canUpdate = perms.update ?? false\n  const canDelete = perms.delete ?? false\n  \n  // Check column-level permissions if table-level is missing\n  if (!canInsert || !canUpdate || !canSelect) {\n    const attrs = pgClass.getAttributes().filter(a =\u003e a.attnum \u003e 0)\n    for (const attr of attrs) {\n      const attrPerms = entityPermissions(introspection, attr, role, true)\n      canSelect ||= Boolean(attrPerms.select)\n      canInsert ||= Boolean(attrPerms.insert)\n      canUpdate ||= Boolean(attrPerms.update)\n    }\n  }\n  \n  return { canSelect, canInsert, canUpdate, canDelete }\n}\n```\n\n**Add `buildFieldPermissions` function:**\n```typescript\nfunction buildFieldPermissions(\n  introspection: Introspection,\n  attr: PgAttribute,\n  tablePerms: EntityPermissions,\n  role: PgRoles\n): FieldPermissions {\n  const attrPerms = entityPermissions(introspection, attr, role, true)\n  \n  return {\n    canSelect: attrPerms.select ?? tablePerms.canSelect,\n    canInsert: attrPerms.insert ?? tablePerms.canInsert,\n    canUpdate: attrPerms.update ?? tablePerms.canUpdate,\n  }\n}\n```\n\n**Reference:** `packages/pg-sourcerer/introspection.mjs:420-466` for existing pattern","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T13:05:47.94165513-06:00","updated_at":"2026-01-06T13:18:09.039138135-06:00","closed_at":"2026-01-06T13:18:09.039138135-06:00","close_reason":"Helper functions and wiring done as part of hbl parent issue","labels":["ir","phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-6g1","depends_on_id":"pg-sourcerer-spt","type":"blocks","created_at":"2026-01-06T13:06:12.119317061-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-6g1","depends_on_id":"pg-sourcerer-hbl","type":"parent-child","created_at":"2026-01-06T13:06:16.839234323-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-6lg","title":"Design query plugin architecture","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T11:36:56.305445549-06:00","updated_at":"2026-01-07T11:41:28.930761253-06:00","closed_at":"2026-01-07T11:41:28.930761253-06:00","close_reason":"Design completed via conversation - raw SQL, Promise-based, requires types plugin"}
{"id":"pg-sourcerer-6ph","title":"emissions: Refactor prependImports for loops to functional patterns","description":"Refactor prependImports loops to use pipe/Array.reduce/flatMap patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T20:04:06.915607954-06:00","updated_at":"2026-01-07T20:06:01.363259251-06:00","closed_at":"2026-01-07T20:06:01.363259251-06:00","close_reason":"Refactored prependImports: for loops → Array.reduce + Array.flatMap + Arr.map, extracted resolveImportRef helper"}
{"id":"pg-sourcerer-6v6","title":"Add GitHub Actions workflow for npm publish","description":"Create a GitHub Actions workflow that:\n- Triggers on release tags (v*)\n- Runs tests\n- Builds the package\n- Publishes to npm\n\nConsider also adding a CI workflow for PRs that runs tests and typecheck.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T10:55:47.23586906-06:00","updated_at":"2026-01-07T10:59:51.097422715-06:00","closed_at":"2026-01-07T10:59:51.097422715-06:00","close_reason":"Added release.yml (triggers on v* tags, runs tests, builds, publishes to npm) and ci.yml (runs on PRs/push to main for testing)","labels":["ci","p2","publish"],"dependencies":[{"issue_id":"pg-sourcerer-6v6","depends_on_id":"pg-sourcerer-p1l","type":"parent-child","created_at":"2026-01-07T10:57:12.442830255-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-6w8","title":"Update ir-builder.ts to add enums to entities map","description":"Modify buildSemanticIR to create EnumEntity objects and add them to ir.entities instead of ir.enums. Remove enum-specific building code that targets separate map.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:10.937382701-06:00","updated_at":"2026-01-07T14:26:19.985714914-06:00","closed_at":"2026-01-07T14:26:19.985714914-06:00","close_reason":"buildEntity now returns TableEntity. buildEnum now returns EnumEntity with kind: \"enum\". Enums are added to builder.entities instead of builder.enums. tableName replaced with pgName.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-6w8","depends_on_id":"pg-sourcerer-3p5","type":"blocks","created_at":"2026-01-07T14:23:23.388815042-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-72u","title":"Inflection Service Implementation","description":"Implement CoreInflection service with naming transformations:\n- camelCase, pascalCase\n- pluralize, singularize\n- safeIdentifier (handle reserved words)\n- entityName, shapeName, fieldName\n- enumName, enumValueName\n- relationName\n\nCurrently stubbed - all methods throw \"not implemented\".","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:22:56.727789317-06:00","updated_at":"2026-01-05T19:50:38.846239791-06:00","closed_at":"2026-01-05T19:50:38.846239791-06:00","close_reason":"Implemented all CoreInflection methods: camelCase/pascalCase via Effect String module, naive pluralize/singularize, safeIdentifier with reserved words, entityName/shapeName/fieldName/enumName/enumValueName/relationName with tag overrides.","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-72u","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:22:56.729599696-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-78f","title":"Verify compiled output works for Node.js consumers","description":"After adding build script and exports config, verify the package works when consumed:\n- Build the package\n- Create a simple test project that imports from the built package\n- Ensure types resolve correctly\n- Ensure runtime works (not just types)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:55:55.325351407-06:00","updated_at":"2026-01-07T11:02:21.660869758-06:00","closed_at":"2026-01-07T11:02:21.660869758-06:00","close_reason":"Verified: Built CLI works from example package (`bun run dry` succeeds), all 445 tests pass with updated dependencies. Updated example to use `pgsourcerer` bin instead of direct .ts path. Consolidated Effect packages in root catalog.","labels":["p0","publish"],"dependencies":[{"issue_id":"pg-sourcerer-78f","depends_on_id":"pg-sourcerer-bf0","type":"blocks","created_at":"2026-01-07T10:55:55.380950887-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-78f","depends_on_id":"pg-sourcerer-3c2","type":"blocks","created_at":"2026-01-07T10:55:55.382947585-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-78f","depends_on_id":"pg-sourcerer-p1l","type":"parent-child","created_at":"2026-01-07T10:57:09.678252663-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-79i","title":"Replace TransformChain string arrays with functions","description":"The current InflectionConfig uses TransformChain (string arrays like [\"singularize\", \"pascalCase\"]) which is limiting. Replace with function-based approach: (input: string, utils: InflectionUtils) =\u003e string. This gives full programmatic control and eliminates the registry lookup pattern.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T23:49:44.71155732-06:00","updated_at":"2026-01-07T10:07:03.703166089-06:00","closed_at":"2026-01-07T10:07:03.703166089-06:00","close_reason":"Duplicate of pg-sourcerer-4ia","dependencies":[{"issue_id":"pg-sourcerer-79i","depends_on_id":"pg-sourcerer-fav","type":"blocks","created_at":"2026-01-06T23:50:47.346867656-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-7a1","title":"Add FK-based query functions to query plugin","description":"Extend the query plugin to generate lookup functions based on foreign key relations.\n\n## Functions to Generate\nFor each FK relation (e.g., posts.user_id → users.id):\n- `getPostsByUserId(userId: string): Promise\u003cPost[]\u003e`\n- `getCommentsByPostId(postId: number): Promise\u003cComment[]\u003e`\n\n## Implementation\n- Use existing Relations in SemanticIR (already populated from FKs)\n- Generate function for belongsTo side (the table with the FK column)\n- Name based on relation: `get{TargetEntity}sBy{LocalColumn}`\n\n## Notes\n- This overlaps with non-unique index lookups if FK columns are indexed\n- Deduplicate: if an index lookup already exists for the same columns, skip\n- Or: always generate FK lookups, they're semantically meaningful even if redundant","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T11:41:56.784437062-06:00","updated_at":"2026-01-07T19:59:17.193815253-06:00","dependencies":[{"issue_id":"pg-sourcerer-7a1","depends_on_id":"pg-sourcerer-3bq","type":"blocks","created_at":"2026-01-07T11:42:05.824906746-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-7by","title":"artifact-store: Refactor getAll for loop to Array.fromIterable","description":"Refactor getAll() for...of loop to use pipe with Array.fromIterable/reduce","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T20:07:49.327174347-06:00","updated_at":"2026-01-07T20:08:44.277436805-06:00","closed_at":"2026-01-07T20:08:44.277436805-06:00","close_reason":"Refactored getAll: for...of loop → pipe with spread operator + Array.reduce"}
{"id":"pg-sourcerer-7e6","title":"Create CLI entry point with @effect/cli","description":"Create src/cli.ts using @effect/cli that orchestrates the full generation pipeline:\n1. Load config via ConfigLoaderService\n2. Introspect database via DatabaseIntrospectionService  \n3. Build IR via IRBuilderSvc\n4. Prepare and run plugins via PluginRunner\n5. Write files via FileWriterSvc\n\nCommand: `pgsourcerer generate [--config \u003cpath\u003e] [--dry-run] [--output \u003cdir\u003e]`","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T15:06:20.81900903-06:00","updated_at":"2026-01-06T15:13:46.093283605-06:00","closed_at":"2026-01-06T15:13:46.093283605-06:00","close_reason":"Created src/cli.ts with @effect/cli. Commands: `pgsourcerer generate [-c config] [-o output] [-n dry-run] [-v verbose]`. Exports generate/runGenerate in index.ts.","labels":["cli","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-7e6","depends_on_id":"pg-sourcerer-9gj","type":"blocks","created_at":"2026-01-06T15:06:33.685557638-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-7e6","depends_on_id":"pg-sourcerer-ylu","type":"blocks","created_at":"2026-01-06T15:06:34.428471867-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-7sa","title":"Investigate RLS permissions in example DB","description":"All User fields show canInsert=false which seems wrong. Either the RLS policies are restrictive or the permission detection is broken. Investigate why and fix - this affects what code gets generated.","notes":"FINDING: Fixture was generated with role='visitor' which has limited permissions:\n- Table: visitor=r (SELECT only, no INSERT)  \n- Column ACLs grant UPDATE on specific columns (username, name, etc.)\n\nThis is why canInsert=false for all fields.\n\nOPTIONS:\n1. Regenerate fixture with owner role - gives full permissions\n2. Make role configurable in introspection/generation\n3. For Model plugin: ignore ACL permissions, base variants on schema (hasDefault, isGenerated) not RLS\n\nRECOMMENDATION: Option 3 for the plugin - ACLs are runtime enforcement, not type generation concerns. Model variants should be:\n- insert: exclude isGenerated/isIdentity fields, make hasDefault optional\n- update: all fields optional\n- sensitive: smart tag controlled","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T22:46:13.074013292-06:00","updated_at":"2026-01-06T22:47:49.54753056-06:00","closed_at":"2026-01-06T22:47:49.54753056-06:00","close_reason":"Root cause found: fixture uses visitor role with limited permissions. For effect-model plugin, will ignore ACL permissions and base variants on schema properties (hasDefault, isGenerated) instead.","labels":["effect-model","rewrite"]}
{"id":"pg-sourcerer-7xo","title":"Configure coverage exclusions for entry points","description":"Configure vitest coverage to exclude files that shouldn't count against coverage:\n- cli.ts (entry point, test via CLI integration)\n- index.ts (re-exports only)\n- scripts/ (build tooling)\n\nUpdate vitest.config.ts with coverage.exclude patterns.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-07T12:41:50.543019227-06:00","updated_at":"2026-01-07T12:47:02.134413602-06:00","closed_at":"2026-01-07T12:47:02.134413602-06:00","close_reason":"Configured vitest coverage exclusions - coverage now 88.39%","dependencies":[{"issue_id":"pg-sourcerer-7xo","depends_on_id":"pg-sourcerer-pj1","type":"parent-child","created_at":"2026-01-07T12:42:50.038844942-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-7yv","title":"Import resolution with cycle detection","description":"Implement import resolution in serializeAst() using Effect Graph.\n\n## ImportRef Types\n```typescript\ntype ImportRef =\n  | { kind: \"symbol\"; ref: SymbolRef; isType?: boolean }\n  | { kind: \"package\"; names?: string[]; types?: string[]; default?: string; from: string }\n  | { kind: \"relative\"; names?: string[]; types?: string[]; default?: string; from: string }\n```\n\n## Resolution Flow\n1. Build import dependency graph (Effect Graph)\n   - Nodes: emitted file paths\n   - Edges: file A imports symbol from file B\n2. Check cycles with Graph.isAcyclic - fail if cyclic\n3. Resolve symbol refs via SymbolRegistry\n   - Look up symbol → get file path\n   - Calculate relative path from importing file\n4. Merge duplicate imports (same `from` path)\n5. Generate import AST nodes\n6. Prepend to program body\n\n## Files\n- services/imports.ts - ImportRef types\n- services/emissions.ts - Update serializeAst()","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T17:46:14.102674669-06:00","updated_at":"2026-01-06T18:07:09.291686349-06:00","closed_at":"2026-01-06T18:07:09.291686349-06:00","close_reason":"Implemented import resolution with cycle detection. FileBuilder.emit() now passes imports to emitAst(), and serializeAst() resolves symbol/package/relative imports via prependImports(). Added 11 new tests for import resolution including symbol resolution, import merging, default imports, and type imports.","labels":["core","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-7yv","depends_on_id":"pg-sourcerer-9pr","type":"parent-child","created_at":"2026-01-06T17:46:36.379454744-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-7yv","depends_on_id":"pg-sourcerer-skq","type":"blocks","created_at":"2026-01-06T17:46:45.298473493-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-7zk","title":"Plugin Runner: Use Live Inflection Instead of Stub","description":"The plugin runner currently passes `InflectionStub` to plugin contexts:\n\n```typescript\n// plugin-runner.ts line 258\ninflection: InflectionStub,  // Throws \"not implemented\"!\n```\n\nIf any plugin calls `ctx.inflection.camelCase()` etc., it will crash.\n\nFix: Accept inflection as a parameter to `run()` or use `InflectionLive` by default.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T21:45:43.271405572-06:00","updated_at":"2026-01-05T21:46:27.542337867-06:00","closed_at":"2026-01-05T21:46:27.542337867-06:00","close_reason":"Duplicate of pg-sourcerer-j42","labels":["core","rewrite"]}
{"id":"pg-sourcerer-85g","title":"IR Builder Service","description":"Build SemanticIR from pg-introspection output.\n\nTransforms raw introspection into:\n- Entities (tables, views, composites)\n- Shapes (row, insert, update, patch)\n- Fields with semantic properties\n- Relations from foreign keys\n- Enums\n\nRequires smart tags parser to be complete for tag extraction.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T17:22:50.795897422-06:00","updated_at":"2026-01-05T20:40:24.023099135-06:00","closed_at":"2026-01-05T20:40:24.023099135-06:00","close_reason":"Implemented IR Builder Service with 16 integration tests against real PostgreSQL database.\n\nFeatures:\n- Transforms pg-introspection output into SemanticIR\n- Builds entities (tables, views) with proper kind detection\n- Builds all 4 shapes (row, insert, update, patch) for tables, row-only for views\n- Fields include: name (camelCase), columnName (original), nullable, optional, hasDefault, isGenerated, isIdentity, isArray, elementTypeName\n- Field optionality varies by shape: row (nullable only), insert (has default/generated/nullable), update/patch (all optional)\n- Relations from FK constraints with column mappings (supports composite FKs)\n- Primary key detection (real PKs and virtual @primaryKey tags for views)\n- Smart tags parsed from comments for all entities/fields/constraints\n- Preserves raw pg-introspection references (pgClass, pgAttribute) for plugin access\n- Tested against real example database with users, posts, views, multiple schemas","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-85g","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:22:50.797132934-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-85g","depends_on_id":"pg-sourcerer-zbb","type":"blocks","created_at":"2026-01-05T17:22:50.798032465-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-88t","title":"Update tests for new plugin patterns","description":"Update all tests to use the new Effect-native plugin patterns:\n\n1. Plugin tests should use `layer()` from @effect/vitest to provide services\n2. Remove any usage of `createStubPluginContext`\n3. Create test layer bundles for common scenarios:\n   - `TestPluginLayers` - IR, Inflection, Emissions, Symbols, TypeHints, ArtifactStore\n   - Per-test IR fixtures via `Layer.succeed(IR, testIR)`\n\nExample:\n```typescript\nconst TestLayers = Layer.mergeAll(\n  InflectionLive,\n  EmissionsLive,\n  SymbolsLive,\n  TypeHintsLive([]),\n  ArtifactStoreLive,\n)\n\nlayer(TestLayers)(\"MyPlugin tests\", (it) =\u003e {\n  it.effect(\"generates types\", () =\u003e\n    Effect.gen(function* () {\n      // Provide test IR for this specific test\n      yield* myPlugin.run(config).pipe(\n        Effect.provideService(IR, testIR)\n      )\n    })\n  )\n})\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T11:28:48.44051642-06:00","updated_at":"2026-01-06T12:32:45.523557818-06:00","closed_at":"2026-01-06T12:32:45.523557818-06:00","close_reason":"Created testing.ts with PluginTestLayers and createPluginTestLayer() utilities for plugin testing. Verified existing tests already use correct patterns - layer() for Effect services, factory functions for unit tests. No createStubPluginContext ever existed to remove.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-88t","depends_on_id":"pg-sourcerer-w1i","type":"blocks","created_at":"2026-01-06T11:28:48.454894398-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-88t","depends_on_id":"pg-sourcerer-y71","type":"blocks","created_at":"2026-01-06T11:28:48.466148139-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-88t","depends_on_id":"pg-sourcerer-qxg","type":"blocks","created_at":"2026-01-06T11:28:48.467184689-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-8by","title":"field-utils: Refactor resolveFieldType to first-match pattern","description":"Refactor resolveFieldType sequential if/Option.isSome checks to use a first-match helper that returns first Some from a list of Option producers","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T20:07:51.171838269-06:00","updated_at":"2026-01-07T20:07:51.171838269-06:00"}
{"id":"pg-sourcerer-8g4","title":"Generate enum schemas for Effect Model plugin","description":"Generate Effect Schema enums from PostgreSQL enums.\n\nOutput format (per earlier discussion):\n```typescript\nexport const Role = S.Union(S.Literal(\"user\"), S.Literal(\"admin\"))\nexport type Role = typeof Role.Type\n```\n\nGenerate in separate file (enums.ts) and import where used.\n\nAlternative inline format for simple enums:\n```typescript\nrole: S.Union(S.Literal(\"user\"), S.Literal(\"admin\"))\n```\n\nMake configurable: separate vs inline.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T22:12:36.888119459-06:00","updated_at":"2026-01-06T22:23:32.72485765-06:00","closed_at":"2026-01-06T22:23:32.72485765-06:00","close_reason":"Implemented in effect-model.ts plugin with 22 passing tests","labels":["effect-model","enums"]}
{"id":"pg-sourcerer-8hh","title":"pg-types: Refactor getExtensionTypeMapping to use Effect patterns","description":"Refactor `getExtensionTypeMapping` to use Effect's `Arr.findFirst` and `Option.flatMap` for nested loops with early return.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:52:12.3002565-06:00","updated_at":"2026-01-07T18:42:36.066260816-06:00","closed_at":"2026-01-07T18:42:36.066260816-06:00","close_reason":"Superseded by pg-sourcerer-ug3 - larger Option\u003cT\u003e refactor"}
{"id":"pg-sourcerer-8ja","title":"pg-types: Refactor composeMappers to pipe pattern","description":"Refactor `composeMappers` function to use pipe() with Arr.map and Arr.findFirst instead of for...of loop with early return.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T19:50:36.400573651-06:00","updated_at":"2026-01-07T20:03:29.431336641-06:00","closed_at":"2026-01-07T20:03:29.431336641-06:00","close_reason":"Refactored composeMappers to use pipe with Array.findFirst and Option.flatMap"}
{"id":"pg-sourcerer-90w","title":"Plugin Runner: Use Live Inflection Instead of Stub","description":"The plugin runner currently passes `InflectionStub` to plugin contexts:\n\n```typescript\n// plugin-runner.ts line 258\ninflection: InflectionStub,  // Throws \"not implemented\"!\n```\n\nIf any plugin calls `ctx.inflection.camelCase()` etc., it will crash.\n\nFix: Accept inflection as a parameter to `run()` or use `InflectionLive` by default.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T21:45:31.502735501-06:00","updated_at":"2026-01-05T21:46:27.533436608-06:00","closed_at":"2026-01-05T21:46:27.533436608-06:00","close_reason":"Duplicate of pg-sourcerer-j42","labels":["core","rewrite"]}
{"id":"pg-sourcerer-9b3","title":"Wire permissions into buildField and buildShape functions","description":"Update `buildField` and `buildShape` to accept and populate permission data.\n\n**Update `buildField` signature:**\n```typescript\nfunction buildField(\n  attr: PgAttribute,\n  tags: SmartTags,\n  kind: ShapeKind,\n  introspection: Introspection,\n  role: PgRoles,\n  tablePerms: EntityPermissions\n): Effect.Effect\u003cField, never, Inflection\u003e\n```\n\n**Update `buildField` implementation:**\n- Call `buildFieldPermissions(introspection, attr, tablePerms, role)`\n- Add `permissions` to the returned Field object\n\n**Update `buildShape` signature:**\n```typescript\nfunction buildShape(\n  entityName: string,\n  kind: ShapeKind,\n  attributes: readonly PgAttribute[],\n  attributeTags: ReadonlyMap\u003cstring, SmartTags\u003e,\n  introspection: Introspection,\n  role: PgRoles,\n  tablePerms: EntityPermissions\n): Effect.Effect\u003cShape, never, Inflection\u003e\n```\n\n**Update `buildShape` implementation:**\n- Pass through new parameters to `buildField`","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T13:05:53.513330624-06:00","updated_at":"2026-01-06T13:18:09.053344742-06:00","closed_at":"2026-01-06T13:18:09.053344742-06:00","close_reason":"Helper functions and wiring done as part of hbl parent issue","labels":["ir","phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-9b3","depends_on_id":"pg-sourcerer-6g1","type":"blocks","created_at":"2026-01-06T13:06:13.149487226-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-9b3","depends_on_id":"pg-sourcerer-hbl","type":"parent-child","created_at":"2026-01-06T13:06:17.960405406-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-9gj","title":"Add CLI dependencies to package.json","description":"Add to catalog and pg-sourcerer package.json:\n- @effect/cli\n- @effect/platform-node\n- pg (runtime)\n- @types/pg (dev)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T15:06:23.071792243-06:00","updated_at":"2026-01-06T15:07:11.834905123-06:00","closed_at":"2026-01-06T15:07:11.834905123-06:00","close_reason":"Added @effect/cli, @effect/platform-node, pg, and @types/pg to catalog and package.json. Renamed package to @danielfgray/pg-sourcerer. Added bin entry.","labels":["cli","rewrite"]}
{"id":"pg-sourcerer-9ii","title":"TypeHint integration for types plugin","description":"Integrate TypeHintRegistry into the types plugin to allow user-configured type overrides.\n\nRequirements:\n- Query TypeHints.getHint(field, 'tsType') for each field before default mapping\n- If user specifies a type, use it instead of computed type\n- Support custom imports: { tsType: 'UserId', import: './types.js' }\n- Add tests for type hint precedence (column \u003e table \u003e pgType)\n\nExample config:\n```typescript\ntypeHints: [\n  { match: { pgType: 'jsonb' }, hints: { tsType: 'JsonValue' } },\n  { match: { table: 'users', column: 'id' }, hints: { tsType: 'UserId', import: './types.js' } },\n]\n```\n","notes":"Blocked on import resolution - need to solve that first before TypeHint integration can work properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:40:11.299125467-06:00","updated_at":"2026-01-06T18:18:48.227624794-06:00","closed_at":"2026-01-06T18:18:48.227624794-06:00","close_reason":"TypeHint integration complete: types plugin now checks TypeHintRegistry before default resolution, supports custom imports with proper grouping by path","labels":["phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-9ii","depends_on_id":"pg-sourcerer-9pr","type":"blocks","created_at":"2026-01-06T17:25:31.342855427-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-9kz","title":"Consolidate test layers - merge InflectionLive, TypeHintsLive, PluginRunner.Default into a single TestLayer","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T10:28:08.874437484-06:00","updated_at":"2026-01-07T11:23:57.016220193-06:00","closed_at":"2026-01-07T11:23:57.016220193-06:00","close_reason":"Added InflectionLive to PluginRunner.Default dependencies. Tests use PluginRunner.Default directly (or DefaultWithoutDependencies for custom inflection). Added PluginRunnerTestLayer to testing.ts."}
{"id":"pg-sourcerer-9pr","title":"FileBuilder + Symbol-Based Import Resolution","description":"Add ImportCollector service for deferred import resolution. Plugins request imports during execution, resolution happens after all plugins run during AST serialization.\n\n## Superseded by FileBuilder Design\n\nThis evolved into a larger redesign - see child tasks for the full plan.","design":"```typescript\ntype ImportRef =\n  | { kind: \"symbol\"; ref: SymbolRef }\n  | { kind: \"package\"; names: string[]; types?: string[]; from: string }\n  | { kind: \"relative\"; names: string[]; types?: string[]; from: string }\n\ninterface ImportCollector {\n  readonly request: (forFile: string, ref: ImportRef) =\u003e void\n  readonly getRequests: (forFile: string) =\u003e readonly ImportRef[]\n  readonly getFiles: () =\u003e readonly string[]\n}\n```\n\nResolution flow:\n1. Plugins call ctx.imports.request(filePath, ref)\n2. After all plugins run, serializeAst() resolves requests\n3. Symbol refs resolved via SymbolRegistry.importFor()\n4. Import AST nodes prepended to program body","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T17:25:27.768801488-06:00","updated_at":"2026-01-06T18:11:12.700454601-06:00","closed_at":"2026-01-06T18:11:12.700454601-06:00","close_reason":"FileBuilder + Symbol-Based Import Resolution epic complete. Implemented: FileBuilder fluent API, exp.* export helpers with symbol metadata, import resolution in serializeAst(), symbol-based cross-file imports, and migrated both types and zod plugins to use the new APIs.","labels":["core","rewrite"]}
{"id":"pg-sourcerer-9w0","title":"pg-types: Refactor getExtensionTypeMapping to pipe pattern","description":"Refactor getExtensionTypeMapping for...of with 3-level nested if to use pipe with Array.findFirst and Option chain","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T20:04:05.453146461-06:00","updated_at":"2026-01-07T20:05:59.65747066-06:00","closed_at":"2026-01-07T20:05:59.65747066-06:00","close_reason":"Refactored getExtensionTypeMapping: for...of with 3-level nested if → pipe with Array.findFirst + Option.flatMap chain"}
{"id":"pg-sourcerer-a06","title":"Add Unit Tests for Inflection Service","description":"The live inflection implementation exists but has no dedicated unit tests:\n\n- `camelCase` / `pascalCase` (delegates to Effect String)\n- `pluralize` / `singularize` (naive implementation)\n- `safeIdentifier` (reserved word handling)\n- `entityName` / `shapeName` / `fieldName` / `enumName`\n- `relationName` (FK constraint → relation name)\n\nAdd tests for edge cases:\n- Reserved words: `class`, `type`, `default`\n- Pluralization: `person` → `people`? (currently naive)\n- Snake case with numbers: `user_v2` → `userV2`\n- Already camelCase input","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:45:55.881766831-06:00","updated_at":"2026-01-06T12:02:25.664111987-06:00","closed_at":"2026-01-06T12:02:25.664111987-06:00","close_reason":"42 inflection tests + 16 emissions tests added, all passing","labels":["core","rewrite","testing"]}
{"id":"pg-sourcerer-a1i","title":"Implement PostgreSQL to Effect Schema type mapping","description":"Map PostgreSQL types to Effect Schema types.\n\nMappings:\n- uuid → S.UUID\n- text/varchar/citext → S.String (configurable default)\n- boolean → S.Boolean\n- int2/int4/integer → S.Number (or S.Int?)\n- int8/bigint → S.BigInt\n- timestamp/timestamptz → S.Date\n- date → S.Date\n- jsonb/json → S.Unknown (or configurable)\n- arrays → S.Array(elementSchema)\n- enums → S.Union(S.Literal(...), ...)\n\nSupport TypeHints override via tsType/schemaType hints.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T22:12:26.796483883-06:00","updated_at":"2026-01-06T22:23:32.721483789-06:00","closed_at":"2026-01-06T22:23:32.721483789-06:00","close_reason":"Implemented in effect-model.ts plugin with 22 passing tests","labels":["effect-model","types"]}
{"id":"pg-sourcerer-afn","title":"Add tests for Index representation in SemanticIR","description":"Test that indexes are correctly captured in SemanticIR.\n\n## Test Cases\n\n### Unit Tests (ir-builder)\n- Table with single-column btree index → IndexDef populated\n- Table with composite index → columns in correct order\n- Unique index → isUnique: true\n- Primary key → isPrimary: true, isUnique: true\n- Partial index → isPartial: true, predicate populated\n- GIN/GIST indexes → method captured correctly\n- Expression index → hasExpressions: true, expression columns as null\n\n### Integration Tests (example DB)\nVerify against known indexes in example database:\n- `users.idx_users_username` - btree, single column\n- `users.idx_users_username_trgm` - gin with operator class\n- `user_emails.uniq_user_emails_verified_email` - unique partial\n- `posts` indexes - gin on array, gist on tsvector\n- `posts_votes` - composite primary key\n\n### Edge Cases\n- Table with no indexes (should have empty array, not undefined)\n- View (indexes don't apply)\n- Index on expression only (no column names)","status":"closed","priority":1,"issue_type":"task","assignee":"dan","created_at":"2026-01-07T11:44:04.039711332-06:00","updated_at":"2026-01-07T12:21:42.438350587-06:00","closed_at":"2026-01-07T12:21:42.438350587-06:00","close_reason":"Added 11 integration tests for Index representation in SemanticIR, covering btree, gin, gist, unique, partial, composite indexes, and views. Tests verified against real example database.","comments":[{"id":2,"issue_id":"pg-sourcerer-afn","author":"dan","text":"Planning tests for SemanticIR indexes using fixture data; need unit coverage for builder edge cases.","created_at":"2026-01-07T18:03:55Z"}]}
{"id":"pg-sourcerer-an1","title":"Plugin Runner: Implement run() and duplicate detection","description":"Complete the plugin-runner.ts implementation:\n1. Add duplicate plugin detection to prepare()\n2. Implement run() method to execute plugins with PluginContext","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T19:40:58.33664391-06:00","updated_at":"2026-01-05T19:44:50.991054105-06:00","closed_at":"2026-01-05T19:44:50.991054105-06:00","close_reason":"Implemented plugin-runner.ts: added duplicate plugin detection to prepare(), implemented run() method that executes plugins sequentially with shared artifacts/emissions/symbols. All 38 tests pass.","labels":["phase-1","rewrite"]}
{"id":"pg-sourcerer-b0a","title":"ir-builder: Refactor computeEntityPermissions to Array.reduce","description":"Refactor `computeEntityPermissions` (lines 133-145) to use Array.reduce instead of for...of with side effects.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T19:50:38.00684774-06:00","updated_at":"2026-01-07T20:03:32.695281693-06:00","closed_at":"2026-01-07T20:03:32.695281693-06:00","close_reason":"Refactored computeEntityPermissions to use Array.reduce instead of for...of with mutation"}
{"id":"pg-sourcerer-b2n","title":"Plugin Runner Core Infrastructure","description":"Build the core plugin runner infrastructure for pg-sourcerer rewrite. This is Phase 1 of the rewrite - establishing the Effect-ts based service layer with stubs, then implementing via RED-GREEN-REFACTOR.\n\nSee ARCHITECTURE.md for full design and packages/sourcerer-rewrite/AGENTS.md for implementation notes.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T17:22:37.781529599-06:00","updated_at":"2026-01-05T17:23:38.413587315-06:00","closed_at":"2026-01-05T17:23:38.413587315-06:00","close_reason":"Initial stubs and wiring complete. All services defined with Context.Tag, stub layers created, tests passing (9/9). See packages/sourcerer-rewrite/","labels":["phase-1","rewrite"]}
{"id":"pg-sourcerer-bf0","title":"Add build script for compiled JS output","description":"Add a `build` script to package.json that runs `tsc` to compile TypeScript to JavaScript. Currently the package only has raw .ts files which won't work for non-Bun consumers. Output should go to `dist/` directory.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:55:35.561343333-06:00","updated_at":"2026-01-07T11:00:32.976365364-06:00","closed_at":"2026-01-07T11:00:32.976365364-06:00","close_reason":"Added `build` script that runs tsc. Also added `clean` and `prepublishOnly` scripts. Excluded __tests__ from tsconfig build.","labels":["p0","publish"],"dependencies":[{"issue_id":"pg-sourcerer-bf0","depends_on_id":"pg-sourcerer-p1l","type":"parent-child","created_at":"2026-01-07T10:57:07.429766117-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-bk6","title":"Effect Schema Plugin","description":"Generate Effect Schema definitions for each entity's shapes.\n\nOutput example for User entity:\n```typescript\nimport { Schema as S } from \"effect\"\n\nexport class UserRow extends S.Class\u003cUserRow\u003e(\"UserRow\")({\n  id: S.UUID,\n  username: S.String,\n  name: S.NullOr(S.String),\n  createdAt: S.Date,\n}) {}\n\nexport class UserInsert extends S.Class\u003cUserInsert\u003e(\"UserInsert\")({\n  id: S.optional(S.UUID),\n  username: S.String,\n  name: S.optional(S.NullOr(S.String)),\n}) {}\n```\n\nRequirements:\n- provides: [\"schemas:effect\", \"schemas\"]\n- Generate S.Class or S.Struct for each shape\n- Map pg types to Effect Schema (uuid→S.UUID, etc.)\n- Handle nullable (S.NullOr) vs optional (S.optional)\n- Support arrays (S.Array)\n- Support enums (S.Literal union or S.Enums)\n- Respect smart tags\n- Query TypeHintRegistry for custom schemas\n- Register symbols for import resolution\n\nNote: Research the best Effect Schema patterns for this use case.","notes":"Deferred - Focus on Kysely first. Can implement later for Effect-based projects.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T21:41:30.447175078-06:00","updated_at":"2026-01-07T10:41:00.795709825-06:00","closed_at":"2026-01-07T10:41:00.795709825-06:00","close_reason":"Redundant - effect-model plugin already generates Effect Schema via @effect/sql Model.Class. Users needing pure schemas without @effect/sql can extract types from the model.","labels":["phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-bk6","depends_on_id":"pg-sourcerer-bt7","type":"blocks","created_at":"2026-01-05T21:41:30.466450499-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-bok","title":"Create PluginMeta service","description":"Create a `PluginMeta` service that provides the current plugin's name and metadata.\n\nThis replaces `ctx.pluginName`. Needed for:\n- Logging (prefix messages with plugin name)\n- Artifact attribution\n- Emission tracking\n\n```typescript\ninterface PluginMeta {\n  readonly name: string\n  // Future: version, etc.\n}\n\nexport class PluginMetaSvc extends Context.Tag(\"PluginMeta\")\u003cPluginMetaSvc, PluginMeta\u003e() {}\n```\n\nLayer created per-plugin by PluginRunner before executing each plugin.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:27:52.535017086-06:00","updated_at":"2026-01-06T11:34:44.802174689-06:00","closed_at":"2026-01-06T11:34:44.802174689-06:00","close_reason":"Created PluginMeta service as Context.Tag in src/services/plugin-meta.ts. Simple value service providing plugin name. Layer created per-plugin with Layer.succeed(PluginMeta, { name }).","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-bok","depends_on_id":"pg-sourcerer-ilk","type":"blocks","created_at":"2026-01-06T11:27:52.548897114-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-boq","title":"Fix double-cleaning bug in composeInflection relationName","description":"In `composeInflection`, the `relationName` function cleans the constraint name (removing `_fkey`, `_id`, and table prefix), then calls `baseInflection.relationName` which cleans it AGAIN.\n\nExample:\n- Input: `posts_user_info_fkey`\n- After first clean: `user_info`\n- Plugin transform (e.g., lowercase): `user_info`  \n- Passed to base relationName which cleans again: `info`\n- Final result: `info` (wrong - should be `userInfo` with camelCase base)\n\nThe comment on line 510 acknowledges this: 'Base would also clean, but we already cleaned' - but then it still calls the base's relationName which does clean again.\n\n**Fix options:**\n1. Create a helper that applies just the transform without cleaning\n2. Pass a flag to skip cleaning on subsequent calls\n3. Restructure relationName to separate cleaning from transformation\n\nSee failing test in `inflection.test.ts` under `composeInflection \u003e relationName composition \u003e composes with base that has camelCase`","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T13:23:46.021310458-06:00","updated_at":"2026-01-07T13:45:05.979215476-06:00","closed_at":"2026-01-07T13:45:05.979215476-06:00","close_reason":"Fixed by removing the double-cleaning problem entirely. relationName is now just a simple string→string transform, so composition works naturally without any cleaning logic to conflict.","dependencies":[{"issue_id":"pg-sourcerer-boq","depends_on_id":"pg-sourcerer-pj1","type":"discovered-from","created_at":"2026-01-07T13:27:35.354257174-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-boq","depends_on_id":"pg-sourcerer-gzj","type":"blocks","created_at":"2026-01-07T13:33:37.356701001-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-bsq","title":"Plugin Runner Capability Resolution","description":"Implement PluginRunner capability resolution:\n\n1. Collect all provides/requires from plugins\n2. Expand implicit provisions (schemas:zod → also provides schemas)\n3. Check for conflicts (same capability from multiple plugins)\n4. Check all requires are satisfied\n5. Topological sort (error on cycles)\n6. Execute plugins in sorted order\n\nCurrently stubbed - prepare() and run() return stub errors.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T17:23:03.184670503-06:00","updated_at":"2026-01-05T18:02:45.541040642-06:00","closed_at":"2026-01-05T18:02:45.541040642-06:00","close_reason":"Implemented plugin runner capability resolution with idiomatic Effect patterns: HashMap for providers, Effect.reduce for single-pass validation, Graph module for topo sort and cycle detection. All 8 tests pass.","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-bsq","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:23:03.186612366-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-bt7","title":"Phase 2: Base Plugins","description":"Implement the first set of code generation plugins that use the Phase 1 infrastructure.\n\nPlugins to build:\n1. Types plugin - generates TypeScript interfaces for entities\n2. Effect Schema plugin - generates Effect Schema definitions + inferred types\n3. Zod plugin - generates Zod schemas + inferred types\n\nEach plugin should:\n- Declare capabilities (provides: \"types\", \"schemas:effect\", \"schemas:zod\")\n- Use PluginContext to emit files\n- Register symbols for cross-file imports\n- Respect smart tags (@omit, @name, @type)\n- Query TypeHintRegistry for user overrides\n- Handle all field types (scalars, arrays, enums, nullable)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T21:41:09.54899253-06:00","updated_at":"2026-01-06T14:45:27.132015759-06:00","closed_at":"2026-01-06T14:45:27.132015759-06:00","close_reason":"Phase 2 complete: Types plugin implemented with full type mapping (domains, enums, arrays, extensions). Effect Schema and Zod plugins now unblocked. Kysely plugins moved to separate epic.","labels":["phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-bt7","depends_on_id":"pg-sourcerer-d7s","type":"blocks","created_at":"2026-01-05T21:46:41.165089426-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-bwx","title":"Call symbols.validate() After Plugin Execution","description":"`SymbolRegistry.validate()` exists to detect collisions (same symbol name in same file from different plugins), but nothing ever calls it:\n\n```typescript\n// symbols.ts - validate() defined\nreadonly validate: () =\u003e readonly SymbolCollision[]\n\n// plugin-runner.ts - never called!\n```\n\nAfter all plugins execute, should call `symbols.validate()` and fail if collisions found.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:45:50.337289998-06:00","updated_at":"2026-01-06T10:09:41.347129501-06:00","closed_at":"2026-01-06T10:09:41.347129501-06:00","close_reason":"run() now automatically validates emissions and symbols after plugin execution. Fails with EmitConflict or SymbolConflict errors.","labels":["core","rewrite"]}
{"id":"pg-sourcerer-bxf","title":"Conjure export helpers with symbol metadata","description":"Add `exp.*` helpers to conjure that produce exports with symbol metadata attached.\n\n## API\n```typescript\nconst { exp, program, ts } = conjure\n\nexp.interface(\"UserRow\", { capability: \"types\", entity: \"User\", shape: \"row\" }, [...props])\nexp.typeAlias(\"Role\", { capability: \"types\", entity: \"Role\" }, ts.union(...))\nexp.const(\"UserRow\", { capability: \"schemas:zod\", entity: \"User\", shape: \"row\" }, zodExpr)\nexp.type(\"UserRow\", { capability: \"schemas:zod\", entity: \"User\", shape: \"row\" }, ts.infer(...))\n```\n\n## Types\n```typescript\ninterface SymbolStatement {\n  readonly _tag: \"SymbolStatement\"\n  readonly node: n.Statement\n  readonly symbol: SymbolMeta\n}\n\ninterface SymbolMeta {\n  readonly name: string\n  readonly capability: CapabilityKey\n  readonly entity: string\n  readonly shape?: string\n  readonly isType: boolean\n  readonly isDefault?: boolean\n}\n\ninterface SymbolProgram {\n  readonly _tag: \"SymbolProgram\"\n  readonly node: n.Program\n  readonly symbols: readonly SymbolMeta[]\n}\n```\n\n## Also add\n- `ts.infer(type)` - produces `z.infer\u003cT\u003e`\n- `ts.typeOf(name)` - produces `typeof X`\n- Update `program()` to extract symbols from SymbolStatements","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T17:45:59.207999953-06:00","updated_at":"2026-01-06T17:53:41.096279847-06:00","closed_at":"2026-01-06T17:53:41.096279847-06:00","close_reason":"Added exp.* helpers (interface, typeAlias, const, type) and symbolProgram() to conjure.ts. All 363 tests pass.","labels":["conjure","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-bxf","depends_on_id":"pg-sourcerer-9pr","type":"parent-child","created_at":"2026-01-06T17:46:34.510045705-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-c5g","title":"Update effect-model plugin to handle unified Entity","description":"Refactor effect-model.ts to iterate ir.entities and switch on entity.kind. Enums use same outputFile inflection. Remove hardcoded enums.ts path.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:15.244344516-06:00","updated_at":"2026-01-07T14:30:37.848916457-06:00","closed_at":"2026-01-07T14:30:37.848916457-06:00","close_reason":"Effect-model plugin now uses getEnumEntities() and getTableEntities(). Each enum gets its own file via outputFile inflection. Uses pgName instead of tableName.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-c5g","depends_on_id":"pg-sourcerer-6w8","type":"blocks","created_at":"2026-01-07T14:23:24.927766818-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-ccd","title":"sql-queries: Missing Promise wrapper on async return types","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-07T16:11:23.989418112-06:00","updated_at":"2026-01-07T19:59:16.07332912-06:00"}
{"id":"pg-sourcerer-cdb","title":"PostgreSQL to TypeScript Type Mapping Utility","description":"Create a shared utility for mapping PostgreSQL types to TypeScript types.\n\nThis is used by multiple plugins and should be extracted to avoid duplication.\n\n```typescript\ninterface PgTypeMapping {\n  // Map pg type name to TS type\n  toTypeScript(pgTypeName: string, options?: { nullable?: boolean, array?: boolean }): string\n  \n  // Map pg type to Zod schema expression\n  toZod(pgTypeName: string, options?: { nullable?: boolean, array?: boolean }): string\n  \n  // Map pg type to Effect Schema expression  \n  toEffectSchema(pgTypeName: string, options?: { nullable?: boolean, array?: boolean }): string\n}\n\n// Example mappings:\n// uuid → string / z.string().uuid() / S.UUID\n// text → string / z.string() / S.String\n// integer → number / z.number().int() / S.Int\n// boolean → boolean / z.boolean() / S.Boolean\n// timestamptz → Date / z.coerce.date() / S.Date\n// jsonb → unknown / z.unknown() / S.Unknown\n// text[] → string[] / z.array(z.string()) / S.Array(S.String)\n```\n\nRequirements:\n- Handle common pg types (text, varchar, int, bigint, uuid, boolean, date, timestamp, timestamptz, jsonb, json)\n- Handle arrays\n- Handle domains (unwrap to base type)\n- Extensible for custom types via TypeHintRegistry\n- Well-tested with comprehensive type coverage","notes":"**Kysely additions needed:**\n- Add `toKysely()` method that returns Kysely type expressions\n- Handle `Generated\u003cT\u003e` for columns with defaults/identity\n- Handle `ColumnType\u003cSelect, Insert, Update\u003e` for complex cases (e.g., timestamptz as Date on select, string on insert)\n\nExample mappings:\n- `uuid` → `string` (base) / `Generated\u003cstring\u003e` (if has default)\n- `timestamptz` → `Date` (select) / `string | Date` (insert)\n- `serial/bigserial` → `Generated\u003cnumber\u003e` / `Generated\u003cbigint\u003e`","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:41:39.053018429-06:00","updated_at":"2026-01-06T13:33:31.04650618-06:00","closed_at":"2026-01-06T13:33:31.04650618-06:00","close_reason":"Implemented pg-types.ts with PgTypeOid constants, defaultPgToTs mapper, composeMappers for plugin overrides, and wrapArrayType/wrapNullable helpers. Core provides sane defaults that plugins can override using composeMappers pattern.","labels":["phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-cdb","depends_on_id":"pg-sourcerer-bt7","type":"parent-child","created_at":"2026-01-06T13:03:01.759503606-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-cfn","title":"Add bin entry to package.json","description":"Add bin field to packages/pg-sourcerer/package.json pointing to CLI entry point","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:06:30.409692803-06:00","updated_at":"2026-01-06T15:13:47.27947894-06:00","closed_at":"2026-01-06T15:13:47.27947894-06:00","close_reason":"bin entry was added as part of pg-sourcerer-9gj package.json update","labels":["cli","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-cfn","depends_on_id":"pg-sourcerer-7e6","type":"blocks","created_at":"2026-01-06T15:06:35.3341294-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-cta","title":"ir-builder: Refactor getTypeName to use Option pattern","description":"Refactor `getTypeName` to use `Option.fromNullable` and `Option.map` instead of nested ternary null checks.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T16:52:14.113405809-06:00","updated_at":"2026-01-07T18:42:37.191598344-06:00","closed_at":"2026-01-07T18:42:37.191598344-06:00","close_reason":"Superseded by pg-sourcerer-ug3 - larger Option\u003cT\u003e refactor"}
{"id":"pg-sourcerer-d4x","title":"Write Effect Model plugin tests","description":"Create comprehensive test suite for Effect Model plugin.\n\nTest cases:\n- Basic entity with all field types\n- Generated/identity fields excluded from insert\n- Fields with defaults are optional on insert\n- Nullable fields use S.NullOr\n- RLS permissions shape variants correctly\n- Sensitive tag excludes from json variants\n- Insert optionality overrides work\n- Enum generation (inline and separate)\n- TypeHints override type mapping\n\nUse fixture introspection data like other plugin tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T22:12:40.726082581-06:00","updated_at":"2026-01-06T22:23:32.726553065-06:00","closed_at":"2026-01-06T22:23:32.726553065-06:00","close_reason":"Implemented in effect-model.ts plugin with 22 passing tests","labels":["effect-model","testing"]}
{"id":"pg-sourcerer-d7s","title":"Core Integration Test - Full Pipeline","description":"Write an integration test that exercises the complete core pipeline:\n\n1. Build IR from test introspection fixture\n2. Prepare plugins (capability resolution, ordering)\n3. Run plugins (they emit code, register symbols)\n4. Validate emissions (no conflicts)\n5. Validate symbols (no collisions)\n6. Write files (or dry-run)\n\nThis test will:\n- Prove the components work together\n- Force resolution of API shape questions\n- Catch missing handoffs between components\n- Serve as documentation of intended usage\n\nThe test should use a simple mock plugin that emits files, not a real plugin.\n\nCurrently blocked by: plugin runner doesn't return emissions, inflection is a stub, etc.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:45:11.83692399-06:00","updated_at":"2026-01-06T11:58:46.207096804-06:00","closed_at":"2026-01-06T11:58:46.207096804-06:00","close_reason":"Core integration test complete: 6 tests covering full pipeline (IR build → plugin prep → run → validate → write), artifact passing, and error cases","labels":["core","rewrite","testing"],"dependencies":[{"issue_id":"pg-sourcerer-d7s","depends_on_id":"pg-sourcerer-zgf","type":"blocks","created_at":"2026-01-05T21:46:37.266281445-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-d7s","depends_on_id":"pg-sourcerer-j42","type":"blocks","created_at":"2026-01-05T21:46:37.295233151-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-d7s","depends_on_id":"pg-sourcerer-2pv","type":"blocks","created_at":"2026-01-05T21:46:37.321227-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-d7s","depends_on_id":"pg-sourcerer-bwx","type":"blocks","created_at":"2026-01-05T21:46:37.345656963-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-dje","title":"Types Plugin - TypeScript Interfaces","description":"Generate TypeScript interfaces for each entity's shapes.\n\nOutput example for User entity:\n```typescript\nexport interface UserRow {\n  id: string\n  username: string\n  name: string | null\n  createdAt: Date\n}\n\nexport interface UserInsert {\n  id?: string\n  username: string\n  name?: string | null\n}\n\nexport interface UserUpdate {\n  id?: string\n  username?: string\n  name?: string | null\n}\n```\n\nRequirements:\n- Generate Row, Insert, Update, Patch shapes for tables\n- Generate only Row shape for views\n- Handle nullable vs optional correctly per shape\n- Map PostgreSQL types to TypeScript (uuid→string, timestamptz→Date, etc.)\n- Support arrays (text[]→string[])\n- Support enums (generate enum types)\n- Respect @omit tags (skip fields/entities)\n- Respect @name tags (rename)\n- Query TypeHintRegistry for custom type mappings\n- Register symbols for cross-plugin imports\n- Emit to configurable output directory","notes":"Deferred - Kysely types plugin covers this need. Can implement later for users who want plain TS types without Kysely.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T21:41:19.084255688-06:00","updated_at":"2026-01-06T14:38:31.763105565-06:00","closed_at":"2026-01-06T14:38:31.763105565-06:00","close_reason":"Implemented in src/plugins/types.ts - generates Row/Insert/Update/Patch interfaces, handles domains, enums, arrays, nullable/optional, @omit/@name tags, symbol registration. TypeHintRegistry integration can be added as enhancement.","labels":["phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-dje","depends_on_id":"pg-sourcerer-bt7","type":"blocks","created_at":"2026-01-05T21:41:19.104708801-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-dkt","title":"sql-queries: Missing sql template tag import","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-07T16:11:22.78398061-06:00","updated_at":"2026-01-07T19:59:16.091211729-06:00"}
{"id":"pg-sourcerer-dpp","title":"Define new Effect-native Plugin interface","description":"Define the new Effect-native Plugin interface where `run` returns an Effect with service requirements in the type.\n\n```typescript\n// Services available to all plugins\ntype PluginServices = IR | Inflection | Emissions | Symbols | TypeHints | ArtifactStoreSvc | PluginMetaSvc\n\ninterface Plugin\u003cTConfig = unknown\u003e {\n  readonly name: string\n  readonly requires?: readonly CapabilityKey[]\n  readonly provides: readonly CapabilityKey[]\n  readonly configSchema: S.Schema\u003cTConfig, unknown\u003e\n  readonly inflection: PluginInflection\n  \n  // New signature: no ctx parameter, services come from Effect context\n  readonly run: (config: TConfig) =\u003e Effect.Effect\u003cvoid, PluginExecutionFailed, PluginServices\u003e\n}\n```\n\nPlugins yield the services they need:\n```typescript\nrun: (config) =\u003e Effect.gen(function* () {\n  const ir = yield* IR\n  const emissions = yield* Emissions\n  // ...\n})\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:28:05.922482108-06:00","updated_at":"2026-01-06T11:37:08.105747525-06:00","closed_at":"2026-01-06T11:37:08.105747525-06:00","close_reason":"Created new Effect-native Plugin interface in src/services/plugin.ts. Key change: `run: (config) =\u003e Effect\u003cvoid, E, Services\u003e` - no ctx parameter, plugins yield services from Effect context. Also exports PluginInflection, PluginServices, ConfiguredPlugin types.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-dpp","depends_on_id":"pg-sourcerer-vvw","type":"blocks","created_at":"2026-01-06T11:28:05.93715052-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-dpp","depends_on_id":"pg-sourcerer-mj8","type":"blocks","created_at":"2026-01-06T11:28:05.949390541-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-dpp","depends_on_id":"pg-sourcerer-bok","type":"blocks","created_at":"2026-01-06T11:28:05.95103818-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-drn","title":"Plugin Runner: Accept TypeHints from Config","description":"TypeHints registry is hardcoded to empty:\n\n```typescript\n// plugin-runner.ts line 249\nconst typeHints = emptyTypeHintRegistry  // User config ignored!\n```\n\nThe runner should accept `TypeHint[]` from config and create a real registry via `createTypeHintRegistry(hints)`.\n\nThis allows users to configure type overrides as designed in ARCHITECTURE.md.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:45:39.02615082-06:00","updated_at":"2026-01-06T12:22:57.216272573-06:00","closed_at":"2026-01-06T12:22:57.216272573-06:00","close_reason":"PluginRunner.run() now yields TypeHints from context instead of using hardcoded emptyTypeHintRegistry. Tests updated with TypeHintsLive([]) in their layers.","labels":["core","rewrite"]}
{"id":"pg-sourcerer-e12","title":"ir-builder: Refactor getPrimaryKeyConstraint to Arr.findFirst","description":"Refactor `getPrimaryKeyConstraint` (lines 330-333) to use pipe with Arr.findFirst instead of Array.find.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T19:50:39.309426024-06:00","updated_at":"2026-01-07T19:50:39.309426024-06:00"}
{"id":"pg-sourcerer-een","title":"Add LICENSE file (MIT)","description":"Add an MIT LICENSE file to the repository root. Required for open source publication.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:55:32.746919366-06:00","updated_at":"2026-01-07T11:04:38.388521167-06:00","closed_at":"2026-01-07T11:04:38.388521167-06:00","close_reason":"Added MIT LICENSE file at repo root with credit to Benjie Gillam / graphile-crystal for inspiration.","labels":["p0","publish"],"dependencies":[{"issue_id":"pg-sourcerer-een","depends_on_id":"pg-sourcerer-p1l","type":"parent-child","created_at":"2026-01-07T10:57:06.270773064-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-esj","title":"Symbol Registry Import Resolution","description":"Implement relative import path calculation in SymbolRegistry.importFor():\n\n- Calculate relative path from importer to importee\n- Add .js extension for ESM\n- Separate type imports from value imports\n- Handle same directory vs parent directory\n\nCurrent implementation is naive stub.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:23:14.311590952-06:00","updated_at":"2026-01-05T21:23:58.230286487-06:00","closed_at":"2026-01-05T21:23:58.230286487-06:00","close_reason":"Implemented relative import path calculation in SymbolRegistry.importFor(). Handles: same directory (./), sibling directories (../), nested paths, common parent directories, .ts to .js extension conversion. Separates type imports, named imports, and default exports. 22 tests covering all path calculation scenarios and import types.","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-esj","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:23:14.312838243-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-eyv","title":"Update README with current API documentation","description":"The current README is outdated - references old API like `makeTypesPlugin`, `makeZodSchemasPlugin`, `makeQueriesPlugin`. Update to document:\n- Installation instructions\n- Current plugin names: `typesPlugin`, `zodPlugin`, `effectModelPlugin`\n- `defineConfig` usage\n- CLI usage (`pgsourcerer generate`)\n- Basic example configuration\n- Smart tags documentation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:55:41.910068156-06:00","updated_at":"2026-01-07T11:06:04.103724491-06:00","closed_at":"2026-01-07T11:06:04.103724491-06:00","close_reason":"Rewrote README with: installation, quick start with defineConfig example, CLI usage, plugin table, smart tags examples, type hints config, and development instructions.","labels":["docs","p1","publish"],"dependencies":[{"issue_id":"pg-sourcerer-eyv","depends_on_id":"pg-sourcerer-p1l","type":"parent-child","created_at":"2026-01-07T10:57:10.803594912-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-ezj","title":"Refactor TypeHintRegistry.getHint() to return Option\u003cT\u003e","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T19:09:28.852191125-06:00","updated_at":"2026-01-07T19:09:28.852191125-06:00"}
{"id":"pg-sourcerer-fav","title":"Add file path inflection to plugin config","description":"File paths in generated output should be configurable through inflection, not just entity/field names. For example, users might want 'User.ts' vs 'user.ts' vs 'users.ts'. This should compose with plugin defaults just like entity names do.","design":"## Design: fileName via Effect Context (DI)\n\n### Principle\nConfig stays pure/immutable data. Derived behavior accessed via Effect context.\n\n### Architecture\n1. **Config = pure data**: `{ outputDir: \"models\", enumStyle: \"separate\" }`\n2. **fileName lives in plugin definition**: `inflection.outputFile` (already updated)\n3. **Plugin runner provides via context**: Add `pluginInflection` to `SimplePluginContext`\n\n### SimplePluginContext addition\n```typescript\ninterface SimplePluginContext {\n  // ... existing ...\n  \n  /** Plugin's inflection for file/symbol naming */\n  readonly pluginInflection: PluginInflection\n}\n```\n\n### Usage in plugin run()\n```typescript\nrun: (ctx, config) =\u003e {\n  for (const entity of ctx.ir.entities.values()) {\n    const fileNameCtx: FileNameContext = {\n      entityName: className,\n      tableName: entity.tableName,\n      schema: entity.schemaName,\n      inflection: ctx.inflection,\n      entity,\n    }\n    const fileName = ctx.pluginInflection.outputFile(fileNameCtx)\n    const filePath = `${config.outputDir}/${fileName}`\n    // ...\n  }\n}\n```\n\n### User customization (future)\nUsers can wrap/override plugins to customize fileName:\n```typescript\nconst myPlugin = effectModelPlugin({ outputDir: \"models\" })\n// Override inflection at plugin level (mechanism TBD)\n```\n\n### Benefits\n- Config stays serializable/immutable\n- Plugin definition declares defaults  \n- Behavior accessed via DI, consistent with Effect patterns\n- No function-in-schema complexity","notes":"## Progress\n\n### Completed\n1. Updated PluginInflection.outputFile signature: (ctx: FileNameContext) =\u003e string\n2. Added FileNameContext type with entityName, tableName, schema, inflection, entity\n3. Updated all tests to use new signature\n4. Updated all plugins (effect-model, types, zod) to use new signature\n5. All 439 tests passing\n\n### Next Steps\n1. Add pluginInflection to SimplePluginContext (provide via plugin runner)\n2. Update plugins to use ctx.pluginInflection.outputFile(fileNameCtx) for paths\n3. Remove fileName from InflectionConfig (lines 217-230, added prematurely)\n4. Add tests for custom outputFile behavior\n\n### Files Modified (uncommitted)\n- src/services/plugin.ts - FileNameContext type, updated PluginInflection\n- src/services/inflection.ts - has fileName in InflectionConfig (to remove)\n- src/plugins/effect-model.ts, types.ts, zod.ts - updated outputFile signatures\n- src/__tests__/*.ts - updated test plugins","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T23:13:45.403010639-06:00","updated_at":"2026-01-07T10:10:25.795494969-06:00","closed_at":"2026-01-07T10:10:25.795494969-06:00","close_reason":"Merged into pg-sourcerer-4ia - the work is tightly coupled","labels":["rewrite"]}
{"id":"pg-sourcerer-gbj","title":"Kysely Types Plugin","description":"Generate Kysely-compatible type definitions from SemanticIR.\n\n**Output:**\n```typescript\n// generated/database.ts\nimport { Generated, Insertable, Selectable, Updateable } from 'kysely'\n\nexport interface UsersTable {\n  id: Generated\u003cstring\u003e\n  username: string\n  name: string | null\n  created_at: Generated\u003cDate\u003e\n}\n\nexport type User = Selectable\u003cUsersTable\u003e\nexport type NewUser = Insertable\u003cUsersTable\u003e\nexport type UserUpdate = Updateable\u003cUsersTable\u003e\n\nexport interface Database {\n  'app_public.users': UsersTable\n  // ... other tables\n}\n```\n\n**Requirements:**\n- `provides: [\"types:kysely\", \"types\"]`\n- `requires: [\"type-mappings\"]`\n- Use `Generated\u003cT\u003e` for columns with defaults or identity\n- Use schema-qualified keys in Database interface (`schema.table`)\n- Only generate Insert/Update shapes if entity has canInsert/canUpdate permissions\n- Register symbols for cross-plugin imports\n- Respect smart tags (@omit, @name)\n\n**Reference:** Kysely codegen patterns and `packages/pg-sourcerer/plugins/types.mjs`","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-06T12:58:45.273917149-06:00","updated_at":"2026-01-07T16:42:03.104192035-06:00","labels":["kysely","phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-gbj","depends_on_id":"pg-sourcerer-hbl","type":"blocks","created_at":"2026-01-06T12:58:59.167870557-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-gbj","depends_on_id":"pg-sourcerer-cdb","type":"blocks","created_at":"2026-01-06T12:58:59.883646671-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-gbj","depends_on_id":"pg-sourcerer-v2b","type":"blocks","created_at":"2026-01-06T13:06:24.308110853-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-gbj","depends_on_id":"pg-sourcerer-0t2","type":"parent-child","created_at":"2026-01-06T14:43:01.208591346-06:00","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"pg-sourcerer-gbj","author":"dan","text":"Resetting - was not actively being worked","created_at":"2026-01-07T16:05:25Z"}]}
{"id":"pg-sourcerer-gdv","title":"Add DomainEntity and CompositeEntity to IR","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T14:52:51.789930207-06:00","updated_at":"2026-01-07T15:03:06.417104892-06:00","closed_at":"2026-01-07T15:03:06.417104892-06:00","close_reason":"Added DomainEntity and CompositeEntity to IR. Domains capture base type info and CHECK constraints. Composites filter by relkind='c' to exclude table row types. Added type guards, helpers, and 8 integration tests."}
{"id":"pg-sourcerer-gmb","title":"Add file() method to SimplePluginContext","description":"Wire FileBuilder into the plugin context.\n\n## Changes to plugin.ts\n```typescript\ninterface SimplePluginContext {\n  // ... existing ...\n  \n  /** Create a file builder for structured emission */\n  file(path: string): FileBuilder\n}\n```\n\n## Implementation\n- file() creates FileBuilder with access to:\n  - EmissionBuffer (for queueing)\n  - SymbolRegistry (for registration on emit)\n  - Plugin name (for tracking)\n\n## Deprecation\n- Keep ctx.emit() and ctx.emitAst() working for now\n- Mark as deprecated in JSDoc\n- Remove in future version","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T17:46:29.14877421-06:00","updated_at":"2026-01-06T18:00:35.878069655-06:00","closed_at":"2026-01-06T18:00:35.878069655-06:00","close_reason":"Added file() method to SimplePluginContext. Plugins can now use ctx.file(path).header().import().ast().emit() for structured emission with automatic symbol registration. 2 new tests, all 377 tests pass.","labels":["core","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-gmb","depends_on_id":"pg-sourcerer-9pr","type":"parent-child","created_at":"2026-01-06T17:46:39.674677032-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-gmb","depends_on_id":"pg-sourcerer-skq","type":"blocks","created_at":"2026-01-06T17:46:46.434262783-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-gzj","title":"Remove inflected name from Relation, keep raw constraint data","description":"Simplify `Relation` in the IR - remove the `name` field (which requires inflection complexity), keep only raw constraint data. Plugins can derive names themselves if needed.\n\n## Changes:\n\n1. **Remove `name` from `Relation` interface** in semantic-ir.ts\n\n2. **Remove `relationName` from `CoreInflection`** interface and all implementations\n\n3. **Remove `relationName` from `InflectionConfig`**\n\n4. **Update `buildRelation` in ir-builder.ts** - stop calling inflection.relationName\n\n5. **Update tests** - remove relationName tests from inflection.test.ts, update ir-builder tests\n\n6. **Remove from classicInflectionConfig** \n\n7. **Remove from composeInflection/composeInflectionConfigs**","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:33:32.485061338-06:00","updated_at":"2026-01-07T13:45:05.371439696-06:00","closed_at":"2026-01-07T13:45:05.371439696-06:00","close_reason":"Simplified relationName to be a simple string transform (name: string) =\u003e string. Removed constraint parsing, side detection, and smart tag handling from inflection - that logic belongs at the call site (plugins). Relations in IR now only store raw constraint data (constraintName, targetEntity, columns, kind, tags) - no inflected name field.","labels":["rewrite"]}
{"id":"pg-sourcerer-ha9","title":"Simplify plugin config syntax with curried definePlugin","description":"Change plugin configuration from object syntax to function call syntax:\n\nBefore:\n  plugins: [\n    { plugin: typesPlugin, config: { outputDir: \"types\" } },\n    { plugin: zodPlugin, config: { outputDir: \"schemas\" } },\n  ]\n\nAfter:\n  plugins: [\n    typesPlugin({ outputDir: \"types\" }),\n    zodPlugin({ outputDir: \"schemas\" }),\n    effectModelPlugin({ outputDir: \"models\" }),\n  ]\n\nImplementation:\n- Update definePlugin to return a curried function that accepts config\n- The returned function returns a ConfiguredPlugin object\n- Update ConfiguredPlugin type or create PluginInstance type\n- Update plugin-runner to handle the new format\n- Update all existing configs and tests","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:24:11.274266415-06:00","updated_at":"2026-01-06T23:36:41.092940693-06:00","closed_at":"2026-01-06T23:36:41.092940693-06:00","close_reason":"Implemented curried definePlugin that returns PluginFactory. Plugins now use simpler syntax: typesPlugin({ outputDir: \"types\" }) instead of { plugin: typesPlugin, config: {...} }"}
{"id":"pg-sourcerer-hbl","title":"Add permissions to SemanticIR","description":"Enrich Entity and Field with permission data during IR building.\n\n**Entity permissions:**\n```typescript\ninterface EntityPermissions {\n  canSelect: boolean\n  canInsert: boolean\n  canUpdate: boolean\n  canDelete: boolean\n}\n```\n\n**Field permissions:**\n```typescript\ninterface FieldPermissions {\n  canSelect: boolean\n  canInsert: boolean\n  canUpdate: boolean\n}\n```\n\n**Implementation:**\n1. Add `permissions` property to `Entity` interface in `semantic-ir.ts`\n2. Add `permissions` property to `Field` interface in `semantic-ir.ts`\n3. Update `ir-builder.ts` to populate permissions using pg-introspection:\n   - Use `entityPermissions(introspection, pgClass, role)` for table-level\n   - Use column ACLs (`PgAttribute.attacl`) for field-level\n   - Fallback to table-level permissions if column ACLs are null\n\n**Reference:** See `packages/pg-sourcerer/introspection.mjs:420-466` for existing pattern using `entityPermissions()`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T12:58:38.077762291-06:00","updated_at":"2026-01-06T13:17:23.13195516-06:00","closed_at":"2026-01-06T13:17:23.13195516-06:00","close_reason":"Phase 2 complete: permissions wired throughout IR builder with types, helpers, and tests","labels":["ir","phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-hbl","depends_on_id":"pg-sourcerer-bt7","type":"parent-child","created_at":"2026-01-06T13:03:00.836693078-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-i2n","title":"Update types plugin to handle unified Entity","description":"Refactor types.ts to iterate ir.entities and switch on entity.kind. Enums use same outputFile inflection as tables/views. Remove hardcoded enums.ts path.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:13.340286833-06:00","updated_at":"2026-01-07T14:28:55.119183114-06:00","closed_at":"2026-01-07T14:28:55.119183114-06:00","close_reason":"Types plugin now uses getEnumEntities() and getTableEntities(). Each enum gets its own file via outputFile inflection. Uses pgName instead of tableName. Helper functions updated to use Iterable\u003cEnumEntity\u003e.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-i2n","depends_on_id":"pg-sourcerer-6w8","type":"blocks","created_at":"2026-01-07T14:23:24.081777542-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-i5a","title":"Integrate Effect logger for plugin logging","description":"Replace console.* calls with Effect's structured logging.\n\nFor simple plugins via `definePlugin`:\n- `ctx.log.info(\"message\")` → internally calls `Effect.logInfo`\n- `ctx.log.debug(\"message\")` → `Effect.logDebug`\n- `ctx.log.warn(\"message\")` → `Effect.logWarning`\n\nFor Effect-native plugins:\n- Use `yield* Effect.logInfo(\"message\")` directly\n\nLogger should include plugin name as annotation (from PluginMeta service).\n\nMay need to configure a LogLayer for the runtime.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T11:27:56.390164317-06:00","updated_at":"2026-01-06T12:30:00.442450043-06:00","closed_at":"2026-01-06T12:30:00.442450043-06:00","close_reason":"Integrated Effect logging for both simple and Effect-native plugins. SimplePluginContext.log methods now use Effect.logDebug/Info/Warning with annotateLogs for plugin name. PluginRunner also adds log annotation around each plugin execution so Effect-native plugins get automatic plugin name context.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-i5a","depends_on_id":"pg-sourcerer-ilk","type":"blocks","created_at":"2026-01-06T11:27:56.403345785-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-i8q","title":"Add integration tests for error scenarios","description":"Add integration tests for error scenarios to verify error handling works correctly:\n\n1. **Config errors**: Missing config file, invalid config schema, missing connectionString\n2. **Database errors**: Invalid connection string, unreachable database  \n3. **Plugin errors**: Plugin throws during execution, capability conflicts, missing dependencies\n\nThese tests verify the error types (ConfigNotFound, ConfigInvalid, ConnectionFailed, etc.) are properly surfaced.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T12:41:54.828132223-06:00","updated_at":"2026-01-07T13:27:24.713194818-06:00","closed_at":"2026-01-07T13:27:24.713194818-06:00","close_reason":"Added 7 error scenario tests in generate.errors.test.ts covering: ConfigNotFound, ConfigInvalid, ConnectionFailed, PluginExecutionFailed (sync and async), CapabilityNotSatisfied, CapabilityConflict","dependencies":[{"issue_id":"pg-sourcerer-i8q","depends_on_id":"pg-sourcerer-pj1","type":"parent-child","created_at":"2026-01-07T12:42:51.465806079-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-ia7","title":"E2E config integration tests (in-memory)","description":"Add integration tests that exercise full config scenarios without writing to disk.\n\nKey features:\n- runConfigInMemory(config, fixture) helper that returns emissions\n- Test different plugin combinations (effect-only, types+zod, all three)\n- Assert on file names (PascalCase with inflectionDefaults)\n- Assert on class/interface names matching file names\n- Test cross-plugin imports work\n- Test type hints applied correctly\n- Test inflection composition (plugin defaults + user config)\n- Test enum handling (inline vs separate file modes)\n\nThis replaces the need for separate config files like pgsourcerer-effect.config.ts","notes":"Created e2e-config.test.ts with 10 tests. 9/10 passing. Last test fails due to inflection composition bug which is being addressed by the inflection refactor tasks (pg-sourcerer-4ia and deps).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T23:21:37.616898569-06:00","updated_at":"2026-01-07T10:35:39.97233253-06:00","closed_at":"2026-01-07T10:35:39.97233253-06:00","close_reason":"All 10 e2e-config tests now passing after inflection refactor"}
{"id":"pg-sourcerer-ib7","title":"Migrate zod plugin to FileBuilder + exp.*","description":"Refactor zod plugin to use new APIs:\n\n## Changes\n- Replace manual symbol registration with exp.* helpers\n- Replace ctx.emitAst() with ctx.file().ast().emit()\n- Replace hardcoded zod import string with package import ref\n- Use exp.const() for zod schemas\n- Use exp.type() for z.infer type exports\n\n## Example\n```typescript\nconst zodStatements = [\n  exp.const(\n    `${entityName}Row`,\n    { capability: \"schemas:zod\", entity: entityName, shape: \"row\" },\n    generateZodObject(entity.shapes.row)\n  ),\n  exp.type(\n    `${entityName}Row`,\n    { capability: \"schemas:zod\", entity: entityName, shape: \"row\" },\n    ts.infer(ts.typeOf(`${entityName}Row`))\n  ),\n]\n\nctx.file(`${config.outputDir}/${entityName}.ts`)\n  .header(\"// Auto-generated. Do not edit.\")\n  .import({ kind: \"package\", names: [\"z\"], from: \"zod\" })\n  .ast(program(...zodStatements))\n  .emit()\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T17:46:24.919475917-06:00","updated_at":"2026-01-06T18:10:57.042106804-06:00","closed_at":"2026-01-06T18:10:57.042106804-06:00","close_reason":"Migrated zod plugin to FileBuilder + exp.* API. Uses ctx.file().header().import().ast().emit() pattern, exp.const() for schema exports, exp.type() for inferred type exports, and package import refs for zod.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-ib7","depends_on_id":"pg-sourcerer-9pr","type":"parent-child","created_at":"2026-01-06T17:46:38.626995087-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-ib7","depends_on_id":"pg-sourcerer-7yv","type":"blocks","created_at":"2026-01-06T17:46:48.595491354-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-ib7","depends_on_id":"pg-sourcerer-gmb","type":"blocks","created_at":"2026-01-06T17:46:51.000483173-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-ilk","title":"Effect-Native Plugin System","description":"Refactor plugin system to use Effect's DI/context instead of prop-drilling a PluginContext object.\n\nCore principle: Plugins become Effects that yield the services they need, rather than receiving an opaque context object.\n\nTwo-tier API:\n- Simple plugins: `definePlugin({ run: (ctx, config) =\u003e void | Promise\u003cvoid\u003e })`\n- Advanced plugins: Return `Effect\u003cvoid, E, Services\u003e` and yield services directly\n\nBenefits:\n- No more manual dependency wiring in PluginRunner\n- Adding new services doesn't require modifying PluginContext\n- Plugins only depend on what they actually use\n- Testing is simpler (provide only needed layers)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-06T11:27:36.806924357-06:00","updated_at":"2026-01-06T12:30:12.79942855-06:00","closed_at":"2026-01-06T12:30:12.79942855-06:00","close_reason":"Effect-Native Plugin System complete. All subtasks done: IR/ArtifactStore/PluginMeta services created, Effect logging integrated, IR builder refactored to yield Inflection, old PluginContext removed. Plugins now use Effect DI (yield* Service) instead of prop-drilling.","labels":["architecture","rewrite"]}
{"id":"pg-sourcerer-im0","title":"sql-queries: Fix type errors and implement QueryKind classification","description":"## Goal\nFix the sql-queries plugin to pass all tests.\n\n## Type Errors to Fix\n1. Line 148 - wrapPromise: Change `b.tsTypeParameterInstantiation([innerType])` to `b.tsTypeParameterInstantiation([toTSType(innerType)])`\n2. Line 376 - Import syntax: Change `symbols: [\"sql\"]` to `names: [\"sql\"]`\n\n## Add QueryKind Classification\nAdd after line ~110:\n```typescript\ntype QueryKind =\n  | { type: \"exactLookup\"; unique: boolean }\n  | { type: \"search\"; method: \"trigram\" | \"fulltext\" }\n  | { type: \"skip\"; reason: string }\n\nfunction classifyIndex(index: IndexDef): QueryKind {\n  if (index.hasExpressions) return { type: \"skip\", reason: \"expression index\" }\n  if (index.isPartial) return { type: \"skip\", reason: \"partial index\" }\n  if (index.columns.length \u003e 1) return { type: \"skip\", reason: \"composite index (future)\" }\n  if (index.method === \"gin\") return { type: \"skip\", reason: \"gin index (future trigram/array support)\" }\n  if (index.method === \"gist\") return { type: \"skip\", reason: \"gist index (future fulltext support)\" }\n  return { type: \"exactLookup\", unique: index.isUnique || index.isPrimary }\n}\n```\n\n## Refactor generateLookupFunctions\n- Use classifyIndex for filtering\n- Deduplicate by column set (unique wins over non-unique)\n- Track `Map\u003ccolumnKey, { index, kind }\u003e`\n\n## Tests to Pass\nRun: `cd packages/pg-sourcerer \u0026\u0026 bun run test src/__tests__/sql-queries-plugin.test.ts`\n\nFailing tests:\n- return types \u003e unique index returns Promise\u003cRow | null\u003e\n- return types \u003e non-unique index returns Promise\u003cRow[]\u003e\n- return types \u003e async functions use await\n- parameter types \u003e uses correct TypeScript types for parameters\n- imports \u003e imports Row type from types plugin\n- imports \u003e imports sql template tag\n- edge cases \u003e no duplicate functions for same column\n\n## Closes\n- pg-sourcerer-102 (field types)\n- pg-sourcerer-yoy (duplicate functions)\n- pg-sourcerer-dkt (sql import)\n- pg-sourcerer-ccd (Promise wrapper)\n- pg-sourcerer-3d9 (await)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T16:34:29.007954716-06:00","updated_at":"2026-01-07T19:59:16.030887947-06:00","dependencies":[{"issue_id":"pg-sourcerer-im0","depends_on_id":"pg-sourcerer-102","type":"blocks","created_at":"2026-01-07T16:34:33.575810611-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-im0","depends_on_id":"pg-sourcerer-yoy","type":"blocks","created_at":"2026-01-07T16:34:33.613908776-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-im0","depends_on_id":"pg-sourcerer-dkt","type":"blocks","created_at":"2026-01-07T16:34:33.649104051-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-im0","depends_on_id":"pg-sourcerer-ccd","type":"blocks","created_at":"2026-01-07T16:34:33.68087988-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-im0","depends_on_id":"pg-sourcerer-3d9","type":"blocks","created_at":"2026-01-07T16:34:33.712125139-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-j3f","title":"Fix effect-model smart tag tests","description":"Smart tag tests are failing due to IR mutation leaking between tests. Need to either: 1) Clone the IR before mutating, or 2) Build fresh IR for each test that needs mutations. Also fix the test assertions to match actual output patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T22:46:08.464912929-06:00","updated_at":"2026-01-06T22:55:51.641275184-06:00","closed_at":"2026-01-06T22:55:51.641275184-06:00","close_reason":"Tests updated for new clean output patterns (Model.Sensitive instead of FieldExcept, DateTimeInsertFromDate instead of S.Date). All 29 effect-model tests pass.","labels":["effect-model","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-j3f","depends_on_id":"pg-sourcerer-4h9","type":"blocks","created_at":"2026-01-06T22:46:20.103229174-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-j42","title":"Plugin Runner: Use Live Inflection Instead of Stub","description":"The plugin runner currently passes `InflectionStub` to plugin contexts:\n\n```typescript\n// plugin-runner.ts line 258\ninflection: InflectionStub,  // Throws \"not implemented\"!\n```\n\nIf any plugin calls `ctx.inflection.camelCase()` etc., it will crash.\n\nFix: Accept inflection as a parameter to `run()` or use `InflectionLive` by default.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T21:46:11.896056994-06:00","updated_at":"2026-01-06T10:18:43.407644863-06:00","closed_at":"2026-01-06T10:18:43.407644863-06:00","close_reason":"Refactored PluginRunner to use Effect.Service pattern. The service now depends on Inflection via layer composition - inflection is captured at service construction time, not required from callers. Tests use createPluginRunner(liveInflection) helper for direct testing without Effect context.","labels":["core","rewrite"]}
{"id":"pg-sourcerer-jfv","title":"Implement insert optionality override via smart tags","description":"Support smart tag to override whether a field is optional on insert.\n\nTag format:\n```json\n{\"sourcerer\": {\"effect:model\": {\"insert\": \"optional\"}}}\n{\"sourcerer\": {\"effect:model\": {\"insert\": \"required\"}}}\n```\n\nUse cases:\n- Force optional even without DB default\n- Force required even with DB default\n\nDefault behavior (without tag) is determined by hasDefault/isGenerated.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T22:12:32.893448573-06:00","updated_at":"2026-01-06T22:40:04.385935899-06:00","closed_at":"2026-01-06T22:40:04.385935899-06:00","close_reason":"Implemented smart tag support: sensitive fields excluded from json variants via Model.FieldExcept, insert optionality override via Model.FieldOption","labels":["effect-model","smart-tags"]}
{"id":"pg-sourcerer-jg6","title":"Add integration test for runGenerate() pipeline","description":"Create integration test that exercises the full runGenerate() pipeline:\n\n1. Create a temp directory with a valid pgsourcerer.config.ts\n2. Call runGenerate() with that config\n3. Verify generated files exist and have correct content\n4. Test with different plugin combinations\n\nThis covers generate.ts (currently 0%) and config-loader.ts (currently 0%) through real usage rather than mocking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T12:41:51.412731915-06:00","updated_at":"2026-01-07T13:03:44.291859822-06:00","closed_at":"2026-01-07T13:03:44.291859822-06:00","close_reason":"Added generate.integration.test.ts with 4 tests covering:\n- Full pipeline with types plugin (detailed output validation)\n- Dry run mode\n- Multiple plugins together\n- Inflection config application\n\nAlso fixed bug in generate.ts where PluginRunner.Default was overriding user inflection config. Coverage for generate.ts: 0% → 97%","dependencies":[{"issue_id":"pg-sourcerer-jg6","depends_on_id":"pg-sourcerer-pj1","type":"parent-child","created_at":"2026-01-07T12:42:50.815721383-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-jgs","title":"Refactor ir-builder.ts getTypeName to use Option\u003cPgType\u003e","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T19:09:23.831178876-06:00","updated_at":"2026-01-07T19:09:23.831178876-06:00"}
{"id":"pg-sourcerer-jpi","title":"Add list/pagination/count functions to query plugin","description":"Add utility query functions beyond index-based lookups.\n\n## Functions to Generate\n\n### List with pagination:\n```typescript\nlistUsers(options?: { \n  limit?: number, \n  offset?: number,\n  orderBy?: 'id' | 'createdAt' | 'username',\n  order?: 'asc' | 'desc'\n}): Promise\u003cUser[]\u003e\n```\n\n### Count:\n```typescript\ncountUsers(): Promise\u003cnumber\u003e\n```\n\n### Existence check:\n```typescript\nuserExistsById(id: string): Promise\u003cboolean\u003e\n```\n\n## Implementation Notes\n- orderBy options from entity columns (or subset - indexed columns?)\n- Default limit to prevent unbounded queries? (configurable)\n- Existence uses `SELECT 1 ... LIMIT 1` for efficiency","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T11:41:58.936196095-06:00","updated_at":"2026-01-07T19:59:17.17883297-06:00","dependencies":[{"issue_id":"pg-sourcerer-jpi","depends_on_id":"pg-sourcerer-7a1","type":"blocks","created_at":"2026-01-07T11:42:06.004915599-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-kdz","title":"ir-builder: Refactor resolveDomainBaseType to Option pipe","description":"Refactor `resolveDomainBaseType` (lines 164-191) to use pipe with Option.filter/flatMap/chain instead of 4 nested guard clauses.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T19:50:38.650925833-06:00","updated_at":"2026-01-07T20:03:34.327959464-06:00","closed_at":"2026-01-07T20:03:34.327959464-06:00","close_reason":"Refactored resolveDomainBaseType to use pipe with Option.fromNullable/filter/flatMap chain"}
{"id":"pg-sourcerer-knj","title":"Implement function composition for inflection","description":"Update composeInflectionConfigs to compose functions: (name) =\u003e user(plugin(name)). Plugin defaults run first, user config refines the result.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T10:03:05.1366603-06:00","updated_at":"2026-01-07T10:10:41.783993339-06:00","closed_at":"2026-01-07T10:10:41.783993339-06:00","close_reason":"Merged into pg-sourcerer-4ia","dependencies":[{"issue_id":"pg-sourcerer-knj","depends_on_id":"pg-sourcerer-4ia","type":"blocks","created_at":"2026-01-07T10:03:15.352958739-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-kxb","title":"Update example config for new plugin format","description":"Rewrite packages/example/pgsourcerer.config.mjs to use the new Effect-based plugin system:\n- Use new Config schema format\n- Use typesPlugin and zodPlugin\n- Remove old makeEffectModelsPlugin etc references","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:06:28.70239618-06:00","updated_at":"2026-01-06T15:15:57.017728117-06:00","closed_at":"2026-01-06T15:15:57.017728117-06:00","close_reason":"Created pgsourcerer.config.ts with new plugin format. Updated package.json scripts. Deleted old .mjs config. Example now generates 25 files (types + zod schemas) successfully.","labels":["example","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-kxb","depends_on_id":"pg-sourcerer-7e6","type":"blocks","created_at":"2026-01-06T15:06:36.051682378-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-lt6","title":"Plugin Runner: Validate Plugin Configs Against Schemas","description":"Plugin configs are never validated against their declared schemas:\n\n```typescript\n// plugin-runner.ts - config passed directly without validation\nreturn plugin.run(ctx, config)  // config could be invalid!\n```\n\nShould decode config through `Schema.decode(plugin.configSchema, config)` either in `prepare()` or at the start of `run()`.\n\nThis will catch config errors early with good error messages via Effect Schema.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:45:35.837819626-06:00","updated_at":"2026-01-06T10:05:23.044743088-06:00","closed_at":"2026-01-06T10:05:23.044743088-06:00","close_reason":"Implemented config validation in prepare(). Plugin configs are now decoded through Schema.decodeUnknown before execution, catching invalid configs early with clear error messages using ParseResult.ArrayFormatter.","labels":["core","rewrite"]}
{"id":"pg-sourcerer-mj8","title":"Create ArtifactStore service","description":"Create an `ArtifactStore` service for plugin-to-plugin data passing.\n\nReplaces `ctx.getArtifact()` and `ctx.setArtifact()`.\n\n```typescript\ninterface ArtifactStore {\n  get: (capability: CapabilityKey) =\u003e Artifact | undefined\n  set: (capability: CapabilityKey, data: unknown) =\u003e void\n}\n\nexport class ArtifactStoreSvc extends Context.Tag(\"ArtifactStore\")\u003cArtifactStoreSvc, ArtifactStore\u003e() {}\n```\n\nThe store is created once per run and shared across all plugins.\nPluginRunner injects the current plugin name when calling `set`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:27:48.470340069-06:00","updated_at":"2026-01-06T11:34:01.048974163-06:00","closed_at":"2026-01-06T11:34:01.048974163-06:00","close_reason":"Created ArtifactStore service using Effect.Service pattern in src/services/artifact-store.ts. Stateful service with get/set/getAll methods for plugin-to-plugin artifact passing.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-mj8","depends_on_id":"pg-sourcerer-ilk","type":"blocks","created_at":"2026-01-06T11:27:48.492634171-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-npp","title":"Implement sensitive field exclusion via smart tags","description":"Support smart tag to mark fields as sensitive (excluded from json variants).\n\nTag format:\n```json\n{\"sourcerer\": {\"effect:model\": {\"sensitive\": true}}}\n```\n\nBehavior:\n- sensitive: true → exclude from json, jsonCreate, jsonUpdate variants\n- Field still appears in select/insert/update (if RLS allows)\n\nThis mirrors Model.Sensitive() behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T22:12:29.963019727-06:00","updated_at":"2026-01-06T22:40:04.394206349-06:00","closed_at":"2026-01-06T22:40:04.394206349-06:00","close_reason":"Implemented smart tag support: sensitive fields excluded from json variants via Model.FieldExcept, insert optionality override via Model.FieldOption","labels":["effect-model","smart-tags"]}
{"id":"pg-sourcerer-ntu","title":"Plugin Integration Test with Fixture","description":"Create integration tests that verify the full pipeline:\n1. Load introspection fixture (from example database)\n2. Build IR\n3. Run plugin(s)\n4. Assert emitted files match expected output\n\nUse the introspection fixture created in Phase 1 (src/__tests__/fixtures/).\n\nTest scenarios:\n- Types plugin generates correct interfaces for User, Post entities\n- Zod plugin generates correct schemas\n- Effect Schema plugin generates correct schemas\n- Plugins respect @omit tags\n- Plugins respect @name tags\n- TypeHintRegistry overrides are applied\n- Symbol registration works for cross-file imports\n- Enum types are generated correctly\n\nThis validates the full integration without needing a live database.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:41:44.373199941-06:00","updated_at":"2026-01-06T12:34:04.564029494-06:00","closed_at":"2026-01-06T12:34:04.564029494-06:00","close_reason":"Already implemented in core-pipeline.integration.test.ts - covers full pipeline with IR building, plugin execution, emissions validation, symbol registration, artifact passing, file writing, and error cases","labels":["phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-ntu","depends_on_id":"pg-sourcerer-bt7","type":"blocks","created_at":"2026-01-05T21:41:44.38766068-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-p1l","title":"Publish pg-sourcerer to npm","description":"Epic tracking all tasks required to make pg-sourcerer publishable to npm as a proper package that works for all Node.js consumers (not just Bun).\n\nWhen this epic is closed, the package is ready for `npm publish`.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-07T10:57:02.29428852-06:00","updated_at":"2026-01-07T11:14:08.142603809-06:00","closed_at":"2026-01-07T11:14:08.142603809-06:00","close_reason":"All publish tasks complete: LICENSE, build script, package.json exports, Node.js verification, README with plugin docs, release-please automation for changelog + npm publish.","labels":["publish"]}
{"id":"pg-sourcerer-paz","title":"field-utils: Refactor resolveFieldType enum check to Option chain","description":"Refactor `resolveFieldType` enum check (lines 109-120) to use Option chain instead of 3-level nested if.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T19:50:37.090161987-06:00","updated_at":"2026-01-07T20:03:31.648803569-06:00","closed_at":"2026-01-07T20:03:31.648803569-06:00","close_reason":"Refactored resolveFieldType enum check to use Option.fromNullable/flatMap chain"}
{"id":"pg-sourcerer-pbe","title":"Delete dead imports.ts file","description":"The file src/services/imports.ts exports Imports, ImportCollector, createImportCollector, and ImportsLive but none are imported or used anywhere in the codebase. Delete it to reduce confusion and improve coverage metrics.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-07T12:41:34.875152619-06:00","updated_at":"2026-01-07T12:44:12.327741955-06:00","closed_at":"2026-01-07T12:44:12.327741955-06:00","close_reason":"Deleted dead imports.ts file - typecheck and tests pass","dependencies":[{"issue_id":"pg-sourcerer-pbe","depends_on_id":"pg-sourcerer-pj1","type":"parent-child","created_at":"2026-01-07T12:42:49.184782447-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-pcu","title":"Type Hint Registry Implementation","description":"Implement TypeHintRegistry matching and precedence:\n\n- Match fields against configured type hints\n- Specificity scoring: table+column \u003e table \u003e column \u003e pgType\n- Merge hints from multiple matching rules\n- Later rules override earlier (same specificity)\n\nCurrently stubbed - returns empty hints.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T17:23:08.820308639-06:00","updated_at":"2026-01-05T21:22:00.840700579-06:00","closed_at":"2026-01-05T21:22:00.840700579-06:00","close_reason":"Implemented TypeHintRegistry with matching and precedence logic. Scoring: schema=2, table=3, column=4, pgType=1. Higher scores override lower, later rules override earlier at same specificity. 23 tests covering basic matching, non-matching, precedence, merging, and complex scenarios.","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-pcu","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:23:08.821918675-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-pj1","title":"Improve test coverage with focus on integration tests","description":"## Goal\nImprove test coverage from 83% to 90%+ with emphasis on integration/behavior tests over implementation detail tests.\n\n## Current State\n- Overall: 83.38% coverage\n- Many unit tests test implementation details (buffer mechanics, registry internals)\n- Good integration tests exist (core-pipeline, e2e-config) but don't cover full pipeline\n\n## Key Gaps\n\n### 0% Coverage (Entry Points)\n- `cli.ts` - CLI entry point\n- `generate.ts` - Main orchestrator  \n- `config-loader.ts` - Config file discovery/loading\n- `imports.ts` - **DEAD CODE** - not used anywhere, should delete\n\n### Low Coverage\n- `introspection.ts` (61%) - DB connection error paths\n- `plugin.ts` (70%) - async plugin execution, error handling\n- `inflection.ts` (74%) - `composeInflection()` function\n\n## Approach\n\n### Phase 1: Cleanup\n- Delete dead `imports.ts` file\n- Configure coverage exclusions for entry points (`cli.ts`, `index.ts`, `scripts/`)\n\n### Phase 2: Integration Tests (HIGH PRIORITY)\n- Test `runGenerate()` end-to-end with temp config files\n- Test real plugin output with actual database\n- Test error scenarios (invalid config, bad connection string, plugin failures)\n\n### Phase 3: Targeted Unit Tests\n- `composeInflection()` - plugin inflection composition\n- Config validation error messages\n- Plugin async error handling paths\n\n## Success Criteria\n- 90%+ coverage on non-excluded files\n- Integration tests cover: happy path, config errors, DB errors, plugin errors\n- Reduced reliance on implementation-detail tests","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-07T12:40:41.00236706-06:00","updated_at":"2026-01-07T16:41:59.358368118-06:00"}
{"id":"pg-sourcerer-prh","title":"Add index information to SemanticIR","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:36:56.607181735-06:00","updated_at":"2026-01-07T11:41:29.626279068-06:00","closed_at":"2026-01-07T11:41:29.626279068-06:00","close_reason":"Duplicate of pg-sourcerer-t1b which has better description","dependencies":[{"issue_id":"pg-sourcerer-prh","depends_on_id":"pg-sourcerer-6lg","type":"blocks","created_at":"2026-01-07T11:37:02.958844279-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-qn1","title":"Zod Plugin - Zod Schemas","description":"Generate Zod schemas for each entity's shapes.\n\nOutput example for User entity:\n```typescript\nimport { z } from \"zod\"\n\nexport const UserRow = z.object({\n  id: z.string().uuid(),\n  username: z.string(),\n  name: z.string().nullable(),\n  createdAt: z.coerce.date(),\n})\nexport type UserRow = z.infer\u003ctypeof UserRow\u003e\n\nexport const UserInsert = z.object({\n  id: z.string().uuid().optional(),\n  username: z.string(),\n  name: z.string().nullable().optional(),\n})\nexport type UserInsert = z.infer\u003ctypeof UserInsert\u003e\n```\n\nRequirements:\n- provides: [\"schemas:zod\", \"schemas\"]\n- Generate schemas for Row, Insert, Update, Patch shapes\n- Use z.infer for type exports\n- Map pg types to Zod (uuid→z.string().uuid(), etc.)\n- Handle nullable (.nullable()) vs optional (.optional())\n- Support arrays (z.array())\n- Support enums (z.enum())\n- Respect smart tags\n- Query TypeHintRegistry for custom Zod schemas\n- Register symbols for import resolution","notes":"Deferred - Focus on Kysely first. Can implement later for Zod validation use cases.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T21:41:24.77286389-06:00","updated_at":"2026-01-06T14:52:49.500910119-06:00","closed_at":"2026-01-06T14:52:49.500910119-06:00","close_reason":"Implemented Zod plugin with full support for:\\n- Generates z.object() schemas for Row, Insert, Update, Patch shapes\\n- Maps PG types to Zod (uuid→z.string().uuid(), timestamp→z.coerce.date(), etc.)\\n- Handles nullable (.nullable()) and optional (.optional()) correctly\\n- Supports arrays (z.array())\\n- Supports enums (z.enum())\\n- Exports inferred types via z.infer when exportTypes: true\\n- Registers symbols for import resolution\\n- Respects @omit smart tag\\n- 16 tests all passing","labels":["phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-qn1","depends_on_id":"pg-sourcerer-bt7","type":"blocks","created_at":"2026-01-05T21:41:24.79265166-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-qxg","title":"Refactor IR builder helpers to yield Inflection","description":"Refactor IR builder internal helper functions to yield Inflection from Effect context instead of passing it as a parameter.\n\nFunctions to convert:\n- `buildField(attr, tags, inflection, kind)` → `buildField(attr, tags, kind): Effect\u003cField, never, Inflection\u003e`\n- `buildShape(entityName, kind, attributes, attributeTags, inflection)` → remove inflection param\n- `buildEntity(pgClass, inflection, entityNameLookup)` → remove inflection param\n- `buildRelation(fk, inflection, entityNameLookup)` → remove inflection param\n- `buildEnum(pgType, inflection)` → remove inflection param\n- `buildEntityNameLookup(classes, inflection)` → remove inflection param\n\nEach function becomes an Effect that yields `Inflection`:\n```typescript\nfunction buildField(attr, tags, kind): Effect.Effect\u003cField, never, Inflection\u003e {\n  return Effect.gen(function* () {\n    const inflection = yield* Inflection\n    // ... rest of logic\n  })\n}\n```\n\nThe top-level `IRBuilderLive` layer already provides Inflection, so no additional wiring needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T11:28:37.992044266-06:00","updated_at":"2026-01-06T12:28:40.616523424-06:00","closed_at":"2026-01-06T12:28:40.616523424-06:00","close_reason":"Refactored all IR builder helpers to yield Inflection from Effect context. Functions updated: buildField, buildShape, buildEntity, buildRelation, buildRelations, buildEnum, buildEntityNameLookup. IRBuilder.build() now requires Inflection in R type. createIRBuilderService() takes no args.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-qxg","depends_on_id":"pg-sourcerer-ilk","type":"blocks","created_at":"2026-01-06T11:28:38.008353895-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-rb8","title":"plugin-runner: Refactor checkDuplicates to Effect.reduce","description":"Refactor checkDuplicates for...of with Set mutation to use Effect.reduce with HashMap","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T20:07:09.188331036-06:00","updated_at":"2026-01-07T20:07:34.656357773-06:00","closed_at":"2026-01-07T20:07:34.656357773-06:00","close_reason":"Refactored checkDuplicates: for...of with Set mutation → Effect.reduce with immutable Set spread"}
{"id":"pg-sourcerer-s5v","title":"Design Effect Model plugin architecture","description":"Define the overall plugin structure for generating @effect/sql Model classes from the semantic IR.\n\nKey decisions:\n- Plugin config schema (outputDir, string type default, etc.)\n- File organization (one Model per entity file)\n- Import structure (@effect/sql Model, effect Schema)\n- How to handle enums (separate const or inline S.Union)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T22:12:14.081023324-06:00","updated_at":"2026-01-06T22:23:32.71369049-06:00","closed_at":"2026-01-06T22:23:32.71369049-06:00","close_reason":"Implemented in effect-model.ts plugin with 22 passing tests","labels":["design","effect-model"]}
{"id":"pg-sourcerer-skq","title":"FileBuilder API for structured file emission","description":"Create FileBuilder class with fluent API for emitting files.\n\n## API\n```typescript\nctx.file(\"types/User.ts\")\n  .header(\"// Auto-generated\")\n  .import({ kind: \"symbol\", ref: { capability: \"types\", entity: \"Role\" } })\n  .import({ kind: \"package\", names: [\"z\"], from: \"zod\" })\n  .ast(program(...))\n  .emit()\n```\n\n## Interface\n```typescript\ninterface FileBuilder {\n  header(content: string | readonly n.Statement[]): FileBuilder\n  import(ref: ImportRef): FileBuilder\n  ast(program: n.Program | SymbolProgram): FileBuilder\n  content(text: string): FileBuilder\n  emit(): void\n}\n```\n\n## Behavior\n- Mutable builder (method calls accumulate state)\n- Multiple .ast() calls append to program body\n- .ast() extracts symbols from SymbolProgram automatically\n- .emit() registers symbols and queues file for serialization\n- .content() for non-AST files (mutually exclusive with .ast())","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T17:46:06.063859316-06:00","updated_at":"2026-01-06T17:56:46.494438031-06:00","closed_at":"2026-01-06T17:56:46.494438031-06:00","close_reason":"Created FileBuilder with fluent API for structured file emission. Supports headers, imports (tracked for later resolution), AST with symbol extraction, and raw content. 12 new tests, all 375 tests pass.","labels":["core","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-skq","depends_on_id":"pg-sourcerer-9pr","type":"parent-child","created_at":"2026-01-06T17:46:35.263509886-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-skq","depends_on_id":"pg-sourcerer-bxf","type":"blocks","created_at":"2026-01-06T17:46:44.481568733-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-spt","title":"Add EntityPermissions and FieldPermissions types to semantic-ir.ts","description":"Add new permission interfaces to the Semantic IR types.\n\n**Add to `src/ir/semantic-ir.ts`:**\n\n```typescript\n/**\n * Permissions for an entity (table/view) based on connected role's ACLs\n */\nexport interface EntityPermissions {\n  readonly canSelect: boolean\n  readonly canInsert: boolean\n  readonly canUpdate: boolean\n  readonly canDelete: boolean\n}\n\n/**\n * Permissions for a field (column) based on connected role's ACLs\n */\nexport interface FieldPermissions {\n  readonly canSelect: boolean\n  readonly canInsert: boolean\n  readonly canUpdate: boolean\n}\n```\n\n**Update `Entity` interface:**\n```typescript\nexport interface Entity {\n  // ... existing fields ...\n  /** Permissions for the connected role */\n  readonly permissions: EntityPermissions\n}\n```\n\n**Update `Field` interface:**\n```typescript\nexport interface Field {\n  // ... existing fields ...\n  /** Permissions for the connected role */\n  readonly permissions: FieldPermissions\n}\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T13:05:38.46059622-06:00","updated_at":"2026-01-06T13:15:58.536279824-06:00","closed_at":"2026-01-06T13:15:58.536279824-06:00","close_reason":"Added EntityPermissions and FieldPermissions types to semantic-ir.ts, updated Field and Entity interfaces with permissions property","labels":["ir","phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-spt","depends_on_id":"pg-sourcerer-hbl","type":"parent-child","created_at":"2026-01-06T13:06:16.326564896-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-sql1","title":"SQL Queries Plugin - Core Infrastructure","description":"## Overview\nCreate `sql-queries` plugin that generates raw SQL query functions using tagged template strings.\n\n## Output Format\n\n### CRUD Functions\n```typescript\n// queries/User.ts\nexport async function findUserById({ id }: { id: string }): Promise\u003cUserRow | null\u003e {\n  const [result] = await sql\u003cUserRow\u003e`select * from app_public.users where id = ${id}`\n  return result\n}\n\nexport async function findManyUsers({ limit = 50, offset = 0 }: { limit?: number; offset?: number } = {}): Promise\u003cUserRow[]\u003e {\n  return sql\u003cUserRow\u003e`select * from app_public.users limit ${limit} offset ${offset}`\n}\n\nexport async function createUser(data: UserInsert): Promise\u003cUserRow\u003e {\n  const [result] = await sql\u003cUserRow\u003e`insert into app_public.users (name, email) values (${data.name}, ${data.email}) returning *`\n  return result\n}\n\nexport async function updateUser({ id }: { id: string }, data: UserUpdate): Promise\u003cUserRow | null\u003e {\n  const [result] = await sql\u003cUserRow\u003e`update app_public.users set name = ${data.name} where id = ${id} returning *`\n  return result\n}\n\nexport async function deleteUser({ id }: { id: string }): Promise\u003cvoid\u003e {\n  await sql`delete from app_public.users where id = ${id}`\n}\n```\n\n### Index-Based Lookups\n```typescript\nexport async function getUserByUsername({ username }: { username: string }): Promise\u003cUserRow | null\u003e {\n  const [result] = await sql\u003cUserRow\u003e`select * from app_public.users where username = ${username}`\n  return result\n}\n\nexport async function findPostsByUserId({ userId }: { userId: string }): Promise\u003cPostRow[]\u003e {\n  return sql\u003cPostRow\u003e`select * from app_public.posts where user_id = ${userId}`\n}\n```\n\n## Plugin Definition\n\n```typescript\nexport const sqlQueriesPlugin = definePlugin({\n  name: \"sql-queries\",\n  provides: [\"queries\", \"queries:sql\"],\n  requires: [\"types\"],\n  configSchema: S.Struct({\n    outputDir: S.String,\n    /** Custom header to prepend to each generated file (e.g., imports) */\n    header: S.optional(S.String),\n  }),\n  inflection: {\n    outputFile: (ctx) =\u003e `${ctx.entityName}.ts`,\n    symbolName: (entityName, artifactKind) =\u003e `${entityName}${artifactKind}`,\n  },\n  run: (ctx, config) =\u003e { ... }\n})\n```\n\n## Implementation Details\n\n### Query Type Classification\n| Index Kind | Return Type | Destructuring |\n|------------|-------------|---------------|\n| Primary Key | `T \\| null` | `[result]` |\n| Unique Constraint | `T \\| null` | `[result]` |\n| Non-Unique Index | `T[]` | No destructure |\n\n### CRUD Generation Rules (EntityPermissions-based)\n- `findById`: Generate if `canSelect` + has primary key\n- `findMany`: Generate if `canSelect`\n- `create`: Generate if `canInsert`\n- `update`: Generate if `canUpdate`\n- `delete`: Generate if `canDelete`\n\n### Index-Based Generation Rules\n- Skip `isPartial === true`\n- Skip `hasExpressions === true`\n- Skip GIN/GIST indexes (not for equality lookups)\n- Skip multicolumn indexes (feature for later)\n- Skip if column not in shape (permissions)\n\n### SQL Patterns\n- Table references: `schema.table` (e.g., `app_public.users`)\n- Tagged template: `sql\u003cRowType\u003e`...`${params}`\n- INSERT with VALUES: `insert into table (cols) values (${val1}, ${val2}) returning *`\n- Parameter types: `{ columnName: RowShape[columnName].type }`\n\n## Tasks\n1. Create `sql-queries.ts` plugin file\n2. Implement CRUD function generation (findById, findMany, create, update, delete)\n3. Implement index-based lookup generation\n4. Add tests for CRUD generation with permissions\n5. Add tests for index-based lookups (unique vs non-unique)\n6. Export plugin from `index.ts`\n\n## Dependencies\n- `types` capability (for Row/Insert/Update types)\n- `Entity.permissions` (for CRUD filtering)\n- `Entity.indexes` (for lookup generation)\n- `Entity.shapes.row` (for parameter/return types)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T15:59:08.061624168-06:00","updated_at":"2026-01-07T19:59:17.162330628-06:00","labels":["phase-2","query-generator","sql-queries"]}
{"id":"pg-sourcerer-sql2","title":"SQL Queries Plugin - Tests","description":"## Overview\nAdd tests for the SQL queries plugin covering CRUD operations, index-based lookups, and permission filtering.\n\n## Test Categories\n\n### Plugin Structure Tests\n- Plugin has correct name\n- Provides `[\"queries\", \"queries:sql\"]` capabilities\n- Requires `[\"types\"]` capability\n- Config schema accepts `outputDir` and optional `header`\n\n### CRUD Function Tests\n- `findById` returns `Promise\u003cT | null\u003e` with destructure\n- `findMany` returns `Promise\u003cT[]\u003e` with limit/offset defaults (50/0)\n- `create` generates INSERT with VALUES clause and RETURNING\n- `update` generates UPDATE with WHERE id and RETURNING\n- `delete` generates DELETE with WHERE id\n- Functions respect EntityPermissions:\n  - Skip `create` if `!canInsert`\n  - Skip `update` if `!canUpdate`\n  - Skip `delete` if `!canDelete`\n  - Always generate `findById`/`findMany` if `canSelect`\n\n### Index-Based Lookup Tests\n- Unique index (PK, unique constraint) generates `T | null` with destructure\n- Non-unique index generates `T[]` without destructure\n- Skips partial indexes (`isPartial === true`)\n- Skips expression indexes (`hasExpressions === true`)\n- Skips GIN/GIST indexes\n- Skips multicolumn indexes\n\n### Parameter Type Tests\n- Single column parameter typed as `{ columnName: Type }`\n- Type matches Row shape field type (respects nullable)\n\n### SQL Format Tests\n- Table references use `schema.table` format\n- INSERT uses VALUES clause with column list\n- UPDATE uses SET and WHERE clauses\n- Destructuring only for unique lookups\n\n### Integration Tests\n- Works with fixture database introspection data\n- Generated code compiles without type errors\n- Symbol registration for cross-file imports (types plugin)\n\n## Fixtures Needed\n- Entity with all CRUD permissions\n- Entity with restricted permissions (no insert/update/delete)\n- Entity with unique index (username)\n- Entity with non-unique index (user_id FK)\n- Entity with primary key","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T15:59:15.124398642-06:00","updated_at":"2026-01-07T19:59:17.14576222-06:00"}
{"id":"pg-sourcerer-sql3","title":"SQL Queries Plugin - Export from index.ts","description":"## Overview\nUpdate `packages/pg-sourcerer/src/index.ts` to export the new `sqlQueriesPlugin`.\n\n## Changes Required\n\nIn `index.ts`, add to the Plugins section:\n```typescript\nexport { sqlQueriesPlugin } from \"./plugins/sql-queries.js\"\n```\n\n## Verification\nAfter export, users should be able to:\n```typescript\nimport { sqlQueriesPlugin } from \"pg-sourcerer\"\n```\n\n## Pre-requisites\n- `pg-sourcerer-sql1` must be completed first (plugin file exists)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T15:59:17.889233237-06:00","updated_at":"2026-01-07T19:59:17.128985944-06:00"}
{"id":"pg-sourcerer-sql4","title":"SQL Queries Plugin - Documentation","description":"## Overview\nUpdate documentation to include the new SQL queries plugin.\n\n## Changes Required\n\n### 1. ARCHITECTURE.md\nAdd to \"Phase 3: Query \u0026 HTTP Plugins\":\n```markdown\n- [x] SQL Queries Plugin - Generate raw SQL query functions with template strings\n```\n\n### 2. README.md\nAdd to plugins list:\n```markdown\n| `sqlQueriesPlugin` | Generates raw SQL query functions using template strings |\n```\n\n### 3. Config documentation\nAdd example:\n```typescript\nexport default defineConfig({\n  plugins: [\n    typesPlugin({ outputDir: \"types\" }),\n    sqlQueriesPlugin({ \n      outputDir: \"queries\",\n      header: 'import { sql } from \"../db\"',  // optional custom imports\n    }),\n  ],\n})\n```\n\n## Pre-requisites\n- `pg-sourcerer-sql1` must be completed first\n- `pg-sourcerer-sql2` tests should pass","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T15:59:22.702367556-06:00","updated_at":"2026-01-07T19:59:21.463455113-06:00"}
{"id":"pg-sourcerer-svm","title":"Wire permissions into buildEntity and main build function","description":"Update `buildEntity` and the main `build` function to handle permissions.\n\n**Update `buildEntity` signature:**\n```typescript\nfunction buildEntity(\n  pgClass: PgClass,\n  entityNameLookup: ReadonlyMap\u003cstring, string\u003e,\n  introspection: Introspection,\n  role: PgRoles\n): Effect.Effect\u003cEntity, TagParseError, Inflection\u003e\n```\n\n**Update `buildEntity` implementation:**\n1. Call `buildEntityPermissions(introspection, pgClass, role)` early\n2. Pass `introspection`, `role`, `entityPerms` to all `buildShape` calls\n3. Add `permissions: entityPerms` to the entity object\n\n**Update main `build` function:**\n1. Get role: `const role = introspection.getCurrentUser()`\n2. Add error if role is undefined: `Effect.fail(new IntrospectionFailed({ message: \"Could not determine current user\" }))`\n3. Pass `introspection` and `role` to `buildEntity` calls\n\n**Optional: Add role override to `IRBuilderOptions`:**\n```typescript\nexport interface IRBuilderOptions {\n  readonly schemas: readonly string[]\n  /** Override role for permission checking (uses current_user if not specified) */\n  readonly role?: string\n}\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T13:05:59.965564957-06:00","updated_at":"2026-01-06T13:16:39.995817682-06:00","closed_at":"2026-01-06T13:16:39.995817682-06:00","close_reason":"buildEntity now accepts introspection and role params, createIRBuilderImpl gets current user and passes through","labels":["ir","phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-svm","depends_on_id":"pg-sourcerer-9b3","type":"blocks","created_at":"2026-01-06T13:06:13.998270603-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-svm","depends_on_id":"pg-sourcerer-hbl","type":"parent-child","created_at":"2026-01-06T13:06:18.882999938-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-t1b","title":"Add Index representation to SemanticIR","description":"Extend SemanticIR to include index information for each entity. This is foundational for the query plugin.\n\n## New Index Type\n\n```typescript\ninterface IndexDef {\n  name: string                    // PostgreSQL index name\n  columns: readonly string[]      // Column names in order (field names, not column names)\n  columnNames: readonly string[]  // Original PostgreSQL column names\n  isUnique: boolean\n  isPrimary: boolean\n  isPartial: boolean\n  predicate?: string              // WHERE clause for partial indexes (raw SQL)\n  method: 'btree' | 'gin' | 'gist' | 'hash' | 'brin' | 'spgist'\n  hasExpressions: boolean         // true if any \"column\" is actually an expression\n}\n```\n\n## Entity Changes\n\n```typescript\ninterface Entity {\n  // ... existing fields ...\n  indexes: readonly IndexDef[]    // All indexes on this entity\n}\n```\n\n## Implementation in ir-builder.ts\n\n```typescript\nconst indexes = pgClass.getIndexes().map(idx =\u003e {\n  const keys = idx.getKeys()  // Array\u003cPgAttribute | null\u003e\n  const hasExpressions = keys.some(k =\u003e k === null)\n  const columns = keys.filter(k =\u003e k !== null).map(k =\u003e inflection.fieldName(k))\n  \n  return {\n    name: idx.getIndexClass()?.relname ?? 'unknown',\n    columns,\n    columnNames: keys.filter(k =\u003e k !== null).map(k =\u003e k.attname),\n    isUnique: idx.indisunique === true,\n    isPrimary: idx.indisprimary === true,\n    isPartial: idx.indpred !== null,\n    predicate: idx.indpred ?? undefined,\n    method: getIndexMethod(idx),  // helper to resolve amname\n    hasExpressions,\n  }\n})\n```\n\n## Acceptance Criteria\n- [ ] IndexDef type added to semantic-ir.ts\n- [ ] Entity.indexes populated by ir-builder.ts\n- [ ] Primary key index included (with isPrimary: true)\n- [ ] Unique indexes marked correctly\n- [ ] Partial indexes captured with predicate\n- [ ] Expression indexes marked (hasExpressions: true)\n- [ ] Index method captured (btree, gin, etc.)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T11:38:48.525756918-06:00","updated_at":"2026-01-07T12:22:43.662677815-06:00","closed_at":"2026-01-07T12:22:43.662677815-06:00","close_reason":"IndexDef type, Entity.indexes field, and buildIndexes() function implemented as part of writing tests (pg-sourcerer-afn). All acceptance criteria satisfied.","dependencies":[{"issue_id":"pg-sourcerer-t1b","depends_on_id":"pg-sourcerer-afn","type":"blocks","created_at":"2026-01-07T11:44:10.959707-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-u47","title":"Kysely Queries Plugin","description":"Generate permission-aware CRUD query functions using Kysely.\n\n**Output:**\n```typescript\n// generated/queries/users.ts\nimport { Kysely } from 'kysely'\nimport type { Database, User, NewUser, UserUpdate } from '../database'\n\nexport const users = {\n  findById: (db: Kysely\u003cDatabase\u003e, id: string) =\u003e\n    db.selectFrom('app_public.users').selectAll().where('id', '=', id).executeTakeFirst(),\n\n  findMany: (db: Kysely\u003cDatabase\u003e, opts?: { limit?: number; offset?: number }) =\u003e\n    db.selectFrom('app_public.users').selectAll()\n      .$if(opts?.limit != null, q =\u003e q.limit(opts!.limit!))\n      .$if(opts?.offset != null, q =\u003e q.offset(opts!.offset!))\n      .execute(),\n\n  create: (db: Kysely\u003cDatabase\u003e, data: NewUser) =\u003e\n    db.insertInto('app_public.users').values(data).returningAll().executeTakeFirstOrThrow(),\n\n  update: (db: Kysely\u003cDatabase\u003e, id: string, data: UserUpdate) =\u003e\n    db.updateTable('app_public.users').set(data).where('id', '=', id).returningAll().executeTakeFirstOrThrow(),\n\n  // delete only if canDelete permission\n  delete: (db: Kysely\u003cDatabase\u003e, id: string) =\u003e\n    db.deleteFrom('app_public.users').where('id', '=', id).execute(),\n}\n```\n\n**Requirements:**\n- `provides: [\"queries:kysely\", \"queries\"]`\n- `requires: [\"types:kysely\"]`\n- Only generate CRUD methods if entity has corresponding permissions\n- Filter insertable/updateable columns by field-level permissions\n- Use primary key for findById/update/delete\n- Object namespace style (matches existing queries.mjs pattern)\n- Pass `db: Kysely\u003cDatabase\u003e` as first parameter\n\n**Future (not this task):**\n- Index-based `findBy*` methods\n- Relation-following queries\n\n**Reference:** `packages/pg-sourcerer/plugins/queries.mjs` for permission filtering patterns","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-06T12:58:55.577561141-06:00","updated_at":"2026-01-07T16:42:03.079540957-06:00","labels":["kysely","phase-2","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-u47","depends_on_id":"pg-sourcerer-gbj","type":"blocks","created_at":"2026-01-06T12:59:00.718055787-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-u47","depends_on_id":"pg-sourcerer-0t2","type":"parent-child","created_at":"2026-01-06T14:43:01.247172198-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-ues","title":"sql-queries: Add QueryKind discriminator for index classification","description":"Introduce a QueryKind type to classify indexes by their query pattern:\n- exactLookup (btree WHERE col = $1) - implemented\n- search/trigram (ILIKE pattern matching) - future\n- fulltext (tsvector @@) - future  \n- range (btree WHERE col \u003e $1) - future\n- contains (GIN array @\u003e) - future\n- skip (not supported)\n\nThis enables extending the plugin to generate different query functions based on index type.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T16:30:46.190047996-06:00","updated_at":"2026-01-07T19:59:16.003892358-06:00"}
{"id":"pg-sourcerer-ug3","title":"Refactor utilities to return Option\u003cT\u003e instead of T | undefined","description":"## Overview\\nConvert functions returning `T | undefined` to return `Option\u003cT\u003e` for idiomatic Effect patterns.\\n\\n## Scope\\n\\n### Phase 1: Core Utility Functions (pg-types.ts)\\n- `getExtensionTypeMapping(...)` → returns `Option\u003cTsType\u003e`\\n- `findEnumByPgName(...)` → returns `Option\u003cEnumLookupResult\u003e`\\n- Update callers to use `Option` methods instead of `undefined` checks\\n\\n### Phase 2: ir-builder.ts\\n- `getTypeName(pgType: PgType | undefined)` → `getTypeName(pgType: Option\u003cPgType\u003e)`\\n- Update all call sites\\n\\n### Phase 3: Type Hints \u0026 Other Utilities\\n- `TypeHintRegistry.getHint()` → returns `Option\u003cT\u003e`\\n- Any other utility functions with `| undefined` returns\\n\\n## Changes Required\\n\\n### Before\\n```typescript\\nfunction findEnumByPgName(...): EnumLookupResult | undefined {\\n  // ... loop\\n  return undefined\\n}\\n\\nconst result = findEnumByPgName(enums, type)\\nif (result) { ... }\\n```\\n\\n### After\\n```typescript\\nfunction findEnumByPgName(...): Option\u003cEnumLookupResult\u003e {\\n  return pipe(\\n    Arr.from(enums),\\n    Arr.findFirst(enumDef =\u003e enumDef.pgName === pgTypeName),\\n    Option.map(enumDef =\u003e ({ ... }))\\n  )\\n}\\n\\nconst result = findEnumByPgName(enums, type)\\nOption.match(result, {\\n  onNone: () =\u003e ...,\\n  onSome: (r) =\u003e ...\\n})\\n```\\n\\n## Benefits\\n- Explicit about optionality in type signature\\n- Composable with other Effect operations\\n- Cannot accidentally forget null check\\n- Type-safe pipeline with `pipe`\\n\\n## Tasks\\n1. Update `getExtensionTypeMapping` return type and implementation\\n2. Update `findEnumByPgName` return type and implementation\\n3. Update all call sites in codebase\\n4. Update `getTypeName` parameter type\\n5. Update TypeHintRegistry.getHint() return type\\n6. Add tests for new Option-based signatures","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T18:42:29.84269951-06:00","updated_at":"2026-01-07T19:09:34.579309685-06:00","closed_at":"2026-01-07T19:09:34.579309685-06:00","close_reason":"Phase 1 complete: Converted defaultPgToTs, getExtensionTypeMapping, findEnumByPgName to return Option\u003cT\u003e. Fixed extension namespace lookup bug. Updated callers and tests. Created separate tasks for Phase 2 (pg-sourcerer-3si) and Phase 3 (pg-sourcerer-ezj)."}
{"id":"pg-sourcerer-ugl","title":"Update inflection tests for function-based API","description":"Update inflection.test.ts and e2e-config.test.ts to use the new function-based inflection API.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T10:03:09.907264251-06:00","updated_at":"2026-01-07T10:32:29.574351713-06:00","closed_at":"2026-01-07T10:32:29.574351713-06:00","close_reason":"Completed as part of pg-sourcerer-4ia - inflection tests now use function-based API","dependencies":[{"issue_id":"pg-sourcerer-ugl","depends_on_id":"pg-sourcerer-395","type":"blocks","created_at":"2026-01-07T10:03:15.464863452-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-v2b","title":"Add permission tests to ir-builder.test.ts","description":"Add tests verifying permissions are correctly populated in the IR.\n\n**Test cases:**\n\n1. **Entity has permissions object:**\n```typescript\nit.effect(\"entities have permissions\", () =\u003e\n  Effect.gen(function* () {\n    const ir = yield* buildTestIR\n    const user = ir.entities.get(\"User\")\n    expect(user?.permissions).toBeDefined()\n    expect(user?.permissions.canSelect).toBe(true) // visitor role should have select\n  })\n)\n```\n\n2. **Field has permissions object:**\n```typescript\nit.effect(\"fields have permissions\", () =\u003e\n  Effect.gen(function* () {\n    const ir = yield* buildTestIR\n    const user = ir.entities.get(\"User\")\n    const idField = user?.shapes.row.fields.find(f =\u003e f.name === \"id\")\n    expect(idField?.permissions).toBeDefined()\n    expect(idField?.permissions.canSelect).toBe(true)\n  })\n)\n```\n\n3. **Views have permissions:**\n```typescript\nit.effect(\"views have permissions\", () =\u003e\n  Effect.gen(function* () {\n    const ir = yield* buildTestIR\n    // Find a view entity and check permissions\n  })\n)\n```\n\n4. **Permissions reflect role's actual access:**\n- The fixture uses `visitor` role\n- Verify permissions match what that role can actually do\n\n**Note:** May need to examine the fixture to understand what permissions `visitor` has","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T13:06:08.013308028-06:00","updated_at":"2026-01-06T13:17:23.095057631-06:00","closed_at":"2026-01-06T13:17:23.095057631-06:00","close_reason":"Added 4 permission tests: entities have permissions, fields have permissions, views have permissions, permissions are consistent across shapes","labels":["ir","phase-2","rewrite","testing"],"dependencies":[{"issue_id":"pg-sourcerer-v2b","depends_on_id":"pg-sourcerer-svm","type":"blocks","created_at":"2026-01-06T13:06:14.725055007-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-v2b","depends_on_id":"pg-sourcerer-hbl","type":"parent-child","created_at":"2026-01-06T13:06:19.709691397-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-v3v","title":"Update remaining code and tests for unified Entity","description":"Fix any remaining references to ir.enums, EnumDef, entity.tableName. Update test fixtures and assertions. Ensure all tests pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:19.851975748-06:00","updated_at":"2026-01-07T14:47:13.918163941-06:00","closed_at":"2026-01-07T14:47:13.918163941-06:00","close_reason":"Updated all remaining code and tests for unified Entity type. Fixed generate.ts, zod.ts, query.ts, and all test files to use getEnumEntities/getTableEntities/isTableEntity. Renamed tableName to pgName in FileNameContext.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-v3v","depends_on_id":"pg-sourcerer-i2n","type":"blocks","created_at":"2026-01-07T14:23:26.487109881-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-v3v","depends_on_id":"pg-sourcerer-c5g","type":"blocks","created_at":"2026-01-07T14:23:27.341584191-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-v3v","depends_on_id":"pg-sourcerer-37k","type":"blocks","created_at":"2026-01-07T14:23:28.256055402-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-vcg","title":"Refactor TypeHintRegistry.getHint() to return Option\u003cT\u003e","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T19:09:24.693491359-06:00","updated_at":"2026-01-07T19:09:24.693491359-06:00"}
{"id":"pg-sourcerer-vl1","title":"ir-builder: Refactor entity assembly for loops to single forEach","description":"Refactor 5 sequential for loops (entities, enums, domains, composites, functions) to single Array.forEach or flatMap pattern","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T20:06:20.852934815-06:00","updated_at":"2026-01-07T20:06:59.677930789-06:00","closed_at":"2026-01-07T20:06:59.677930789-06:00","close_reason":"Refactored entity assembly: 5 sequential for loops → single Array.forEach over combined array"}
{"id":"pg-sourcerer-vvw","title":"Create IR service for plugin access to SemanticIR","description":"Create an `IR` service (Context.Tag) that provides read-only access to the SemanticIR.\n\nThis replaces `ctx.ir` in the current PluginContext. Plugins will `yield* IR` to get the IR.\n\n```typescript\nexport class IR extends Context.Tag(\"IR\")\u003cIR, SemanticIR\u003e() {}\n\n// In plugin:\nconst ir = yield* IR\nfor (const entity of ir.entities.values()) { ... }\n```\n\nLayer created per-run by PluginRunner after IR is built.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:27:43.964935613-06:00","updated_at":"2026-01-06T11:33:04.478330309-06:00","closed_at":"2026-01-06T11:33:04.478330309-06:00","close_reason":"Created IR service as Context.Tag in src/services/ir.ts. Simple value service providing SemanticIR to plugins. Layer created per-run with Layer.succeed(IR, builtIR).","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-vvw","depends_on_id":"pg-sourcerer-ilk","type":"blocks","created_at":"2026-01-06T11:27:43.978584356-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-w1i","title":"Update PluginRunner to provide layers","description":"Refactor PluginRunner to provide Effect layers instead of creating a PluginContext object.\n\nCurrent flow:\n```typescript\nconst ctx = createPluginContext({ ir, inflection, symbols, ... })\nreturn plugin.run(ctx, config)\n```\n\nNew flow:\n```typescript\n// Create layers for this run\nconst irLayer = Layer.succeed(IR, ir)\nconst artifactLayer = Layer.succeed(ArtifactStoreSvc, artifactStore)\n// ... etc\n\n// For each plugin, create plugin-specific layer\nconst pluginMetaLayer = Layer.succeed(PluginMetaSvc, { name: plugin.name })\n\n// Run plugin with all layers provided\nreturn plugin.run(config).pipe(\n  Effect.provide(irLayer),\n  Effect.provide(pluginMetaLayer),\n  Effect.provide(runLayers),  // Combined layers for run\n)\n```\n\nKey changes:\n- Remove createPluginContext calls\n- Build Layer composition for each run\n- Per-plugin layers for PluginMeta\n- All other services are shared across plugins in a run","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:28:26.053777297-06:00","updated_at":"2026-01-06T11:47:32.606056221-06:00","closed_at":"2026-01-06T11:47:32.606056221-06:00","close_reason":"Refactored PluginRunner to use Effect layers instead of PluginContext object. Key changes:\n- Deleted duplicate type definitions (Plugin, PluginInflection, ConfiguredPlugin) from plugin-runner.ts - now imported from plugin.ts\n- Updated run() method to create layers for all services (IR, Inflection, Emissions, Symbols, TypeHints, ArtifactStore)\n- Per-plugin PluginMeta layer created for each plugin execution\n- Plugins now run via plugin.run(config).pipe(Effect.provide(allLayers))\n- Fixed ArtifactStore to use Context.Tag + factory function instead of Effect.Service\n- Updated definePlugin to catch sync errors with Effect.try\n- Updated tests to use new SimplePluginContext API\nAll 133 tests pass.","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-w1i","depends_on_id":"pg-sourcerer-dpp","type":"blocks","created_at":"2026-01-06T11:28:26.070919227-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-w1i","depends_on_id":"pg-sourcerer-187","type":"blocks","created_at":"2026-01-06T11:28:26.077665444-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-wj8","title":"symbols: Refactor validate/getAll nested for loops to flatMap","description":"Refactor validate() and getAll() nested for loops to use Array.flatMap pattern","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T20:04:08.168533907-06:00","updated_at":"2026-01-07T20:06:02.981795876-06:00","closed_at":"2026-01-07T20:06:02.981795876-06:00","close_reason":"Refactored validate/getAll: nested for loops → Arr.fromIterable + Arr.flatten + Arr.reduce + Arr.filterMap + Arr.flatMap"}
{"id":"pg-sourcerer-xwn","title":"Add unit tests for composeInflection()","description":"Add unit tests for the composeInflection() function in inflection.ts (lines 440-516, currently uncovered).\n\nTest cases:\n- Plugin defaults compose with user config (plugin runs first, user refines)\n- Smart tags still take precedence over composed transforms\n- Empty/undefined configs handled correctly\n- All transform types: entityName, fieldName, enumName, enumValue, shapeSuffix, relationName","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T12:42:00.506154501-06:00","updated_at":"2026-01-07T13:27:30.840125075-06:00","closed_at":"2026-01-07T13:27:30.840125075-06:00","close_reason":"Added 21 unit tests for composeInflection() covering all transform types (entityName, fieldName, enumName, enumValue, shapeSuffix, relationName), smart tag precedence, primitive transform preservation, and multi-transform composition. One test documents bug pg-sourcerer-boq (double-cleaning in relationName).","dependencies":[{"issue_id":"pg-sourcerer-xwn","depends_on_id":"pg-sourcerer-pj1","type":"parent-child","created_at":"2026-01-07T12:42:52.509078175-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-y71","title":"Remove old PluginContext interface","description":"Remove the old PluginContext interface and related code:\n\n- `interface PluginContext` in plugin-context.ts\n- `interface PluginContextDeps`\n- `createPluginContext()` function\n- `class PluginCtx extends Context.Tag` (replaced by individual services)\n\nKeep the file if needed for other exports, or delete entirely if empty.\n\nAlso remove any test utilities like `createStubPluginContext` - tests should use Effect layers instead.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T11:28:30.761883805-06:00","updated_at":"2026-01-06T12:24:48.386679225-06:00","closed_at":"2026-01-06T12:24:48.386679225-06:00","close_reason":"Deleted plugin-context.ts and removed exports from index.ts. Old PluginContext/PluginCtx/createPluginContext were unused - replaced by SimplePluginContext in plugin.ts and individual services (IR, ArtifactStore, PluginMeta, etc.).","labels":["rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-y71","depends_on_id":"pg-sourcerer-ilk","type":"blocks","created_at":"2026-01-06T11:28:30.777221652-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-y9v","title":"Add tests for query plugin core (index lookups)","description":"Test-first development for the query plugin core functionality.\n\n## Test Cases\n\n### SQL Generation\n- Primary key lookup generates correct SELECT with WHERE id = $1\n- Unique index lookup generates correct parameterized SQL\n- Non-unique index lookup returns array type\n- Composite key lookup has multiple parameters ($1, $2)\n- Schema-qualified table names in SQL\n\n### Function Naming\n- `getUserById` from users table + id PK\n- `getUserByUsername` from unique username index\n- `getPostsByUserId` from non-unique user_id index\n- `getVoteByPostIdAndUserId` from composite index\n\n### Type Imports\n- Row type imported from types plugin\n- Import path correctly resolved\n\n### Edge Cases\n- Skip expression-only indexes\n- Skip partial indexes (for now)\n- Handle tables with only PK (no other indexes)\n- Composite primary key\n\n### Integration (against example DB)\n- Generated queries actually execute\n- Return correct types\n- null returned for missing rows (unique)\n- Empty array for missing rows (non-unique)","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-07T11:44:18.510870321-06:00","updated_at":"2026-01-07T16:12:12.436667847-06:00","dependencies":[{"issue_id":"pg-sourcerer-y9v","depends_on_id":"pg-sourcerer-t1b","type":"blocks","created_at":"2026-01-07T11:44:29.659794863-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-y9v","depends_on_id":"pg-sourcerer-102","type":"blocks","created_at":"2026-01-07T16:11:31.076062626-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-y9v","depends_on_id":"pg-sourcerer-yoy","type":"blocks","created_at":"2026-01-07T16:11:31.211727938-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-y9v","depends_on_id":"pg-sourcerer-dkt","type":"blocks","created_at":"2026-01-07T16:11:31.332943359-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-y9v","depends_on_id":"pg-sourcerer-ccd","type":"blocks","created_at":"2026-01-07T16:11:31.456183162-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-y9v","depends_on_id":"pg-sourcerer-3d9","type":"blocks","created_at":"2026-01-07T16:11:31.571637188-06:00","created_by":"daemon"},{"issue_id":"pg-sourcerer-y9v","depends_on_id":"pg-sourcerer-im0","type":"blocks","created_at":"2026-01-07T16:34:37.116964029-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-ylu","title":"Create generate() orchestration function","description":"Create a composable generate() Effect that threads together:\n- Config loading\n- DB introspection\n- IR building\n- Plugin execution\n- File writing\n\nThis is the core pipeline that CLI and programmatic use share.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T15:06:25.534424801-06:00","updated_at":"2026-01-06T15:12:37.438078679-06:00","closed_at":"2026-01-06T15:12:37.438078679-06:00","close_reason":"Created src/generate.ts with generate() and runGenerate() functions that orchestrate the full pipeline: config → introspect → IR → plugins → write files","labels":["cli","rewrite"]}
{"id":"pg-sourcerer-yoy","title":"sql-queries: Duplicate function generation for same index","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-07T16:11:22.032030321-06:00","updated_at":"2026-01-07T19:59:16.108508275-06:00"}
{"id":"pg-sourcerer-z1t","title":"Implement Generated field detection","description":"Detect and handle database-generated fields.\n\nRules:\n- isGenerated: true OR isIdentity: true → Model.Generated(schema)\n- hasDefault: true AND !isGenerated AND !isIdentity AND !nullable → Model.Field with S.optional on insert\n- nullable: true → S.NullOr(schema)\n\nModel.Generated excludes field from insert variant.\nS.optional on insert allows omitting (DB uses DEFAULT).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T22:12:22.140458428-06:00","updated_at":"2026-01-06T22:23:32.723184081-06:00","closed_at":"2026-01-06T22:23:32.723184081-06:00","close_reason":"Implemented in effect-model.ts plugin with 22 passing tests","labels":["effect-model"]}
{"id":"pg-sourcerer-zbb","title":"Smart Tags Parser","description":"Parse JSON smart tags from PostgreSQL COMMENT ON statements.\n\nFormat: `{\"sourcerer\": {...}}` embedded in pg_description comments.\n\nBehavior:\n- Valid JSON with `sourcerer` key → extract and validate against SmartTags schema\n- Valid JSON without `sourcerer` key → no tags (other tools may use their own namespaces)\n- Malformed JSON → TagParseError (fail fast, consider repairjson fixer later)\n- Schema validation failure → TagParseError\n- Empty/no comment → no tags\n\nSee ARCHITECTURE.md \"Smart Tags\" section for full spec.","design":"## Smart Tags Parser - Implementation Plan\n\n### Goal\nParse JSON smart tags from PostgreSQL `COMMENT ON` statements, extracting the `sourcerer` namespace.\n\n### Input/Output\n- **Input**: A comment string from `pg_description`\n- **Output**: `SmartTags` object (validated against the Effect Schema) + optional description text\n\n### Comment Format\n\nValid formats (JSON must be at start, description after newline):\n\n```\n{\"sourcerer\": {...}}\n```\n\n```\n{\"sourcerer\": {...}}\ndescription text here\n```\n\n```\n{\"sourcerer\": {...}}\nline 1\nline 2\n```\n\n**Invalid**: JSON anywhere else, multiple JSON objects, JSON on same line as text after.\n\n### Parsing Behavior\n\n| Scenario | Behavior |\n|----------|----------|\n| Comment starts with `{` | Parse as JSON, extract sourcerer, rest after newline is description |\n| Valid JSON with `sourcerer` key | Extract and validate against SmartTags schema |\n| Valid JSON without `sourcerer` key | No tags (other tools' namespace), rest is description |\n| **Malformed JSON** | **Error (TagParseError)** |\n| Invalid `sourcerer` value (fails schema) | **Error (TagParseError)** |\n| Comment doesn't start with `{` | No tags, entire comment is description |\n| Empty/null comment | No tags, no description |\n\n### Parsing Algorithm\n\n```\n1. If comment is null/empty → return { tags: {}, description: undefined }\n2. Trim leading whitespace\n3. If doesn't start with `{` → return { tags: {}, description: comment }\n4. Find the end of JSON object (first newline after balanced braces, or end of string)\n5. Parse JSON substring with JSON.parse (or Effect equivalent)\n   - On failure → TagParseError\n6. If no `sourcerer` key → return { tags: {}, description: rest after newline }\n7. Validate sourcerer value against SmartTags schema\n   - On failure → TagParseError\n8. Return { tags: sourcerer value, description: rest after newline or undefined }\n```\n\n### API Design\n\n```typescript\ninterface ParsedComment {\n  readonly tags: SmartTags\n  readonly description: string | undefined\n}\n\ntype TagContext = {\n  readonly objectType: \"table\" | \"column\" | \"constraint\" | \"type\"\n  readonly objectName: string\n}\n\nfunction parseSmartTags(\n  comment: string | null | undefined,\n  context: TagContext\n): Effect.Effect\u003cParsedComment, TagParseError\u003e\n```\n\n### Test Cases\n\n**Happy path:**\n- `{\"sourcerer\": {\"name\": \"Foo\"}}` → tags with name, no description\n- `{\"sourcerer\": {\"name\": \"Foo\"}}\\nSome description` → tags + description\n- `{\"sourcerer\": {\"name\": \"Foo\"}}\\nLine 1\\nLine 2` → tags + multiline description\n- `{\"sourcerer\": {\"omit\": true}}` → tags with omit boolean\n- `{\"sourcerer\": {\"omit\": [\"insert\", \"update\"]}}` → tags with omit array\n- `{\"sourcerer\": {\"deprecated\": \"Use other field\"}}` → deprecated with message\n- `{\"sourcerer\": {\"custom\": \"extension\"}}` → extension keys allowed\n\n**No tags (valid):**\n- `null` → empty tags, no description\n- `\"\"` → empty tags, no description\n- `\"Just a description\"` → empty tags, description is the text\n- `{\"other_tool\": {...}}` → empty tags (no sourcerer key), no description\n- `{\"other_tool\": {...}}\\nDescription` → empty tags, description extracted\n\n**Errors:**\n- `{\"sourcerer\": {\"omit\": \"invalid\"}}` → TagParseError (schema validation)\n- `{malformed json}` → TagParseError\n- `{\"sourcerer\": {}` → TagParseError (unclosed brace)\n\n### Implementation\n\n1. Create `src/services/smart-tags-parser.ts`\n2. Tests in `src/__tests__/smart-tags-parser.test.ts`\n3. Export from `src/index.ts`\n\n### Future\n\n- `repairjson` integration for auto-fix suggestions in error messages","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T17:22:44.771111608-06:00","updated_at":"2026-01-05T20:16:55.19479283-06:00","closed_at":"2026-01-05T20:16:55.19479283-06:00","close_reason":"Implemented Smart Tags Parser. Parses JSON from PostgreSQL COMMENT ON statements with format: JSON at start, optional description after newline. Validates against SmartTags Effect Schema. Errors on malformed JSON or invalid schema. 25 tests covering valid formats, no-tags cases, and error cases.","labels":["phase-1","rewrite"],"dependencies":[{"issue_id":"pg-sourcerer-zbb","depends_on_id":"pg-sourcerer-b2n","type":"blocks","created_at":"2026-01-05T17:22:44.773318535-06:00","created_by":"daemon"}]}
{"id":"pg-sourcerer-zgf","title":"Plugin Runner: Return Emissions and Symbols from run()","description":"The plugin runner's run() method currently returns Effect\u003cvoid\u003e, but after execution:\n- The emissions buffer is a local variable (lost)\n- The symbol registry is a local variable (lost)\n- There's no way to validate or retrieve outputs\n\nChange run() to return a result object:\n```typescript\ninterface RunResult {\n  readonly emissions: EmissionBuffer\n  readonly symbols: SymbolRegistry\n  readonly artifacts: ReadonlyMap\u003cCapabilityKey, Artifact\u003e\n}\n```\n\nOr alternatively, have run() accept these as parameters so the caller owns them.\n\nThis is blocking the integration test and file writing.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T21:45:16.981419772-06:00","updated_at":"2026-01-05T21:53:01.248412437-06:00","closed_at":"2026-01-05T21:53:01.248412437-06:00","close_reason":"Implemented RunResult return type for run() method. Now returns emissions buffer, symbol registry, and artifacts map. Fixed emissions conflict detection bug. Added 5 comprehensive tests.","labels":["core","rewrite"]}
{"id":"pg-sourcerer-zn7","title":"Refactor zod plugin to use Conjure DSL","description":"Replace raw recast builder calls with conjure DSL in the zod plugin. Should simplify code and remove need for local cast helpers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:32:40.100030587-06:00","updated_at":"2026-01-06T15:37:36.420795723-06:00","closed_at":"2026-01-06T15:37:36.420795723-06:00","close_reason":"Refactored zod.ts to use conjure DSL. Replaced raw recast builders with conjure.id().method(), conjure.obj(), conjure.ts.*, etc. Removed local cast helpers, now imports from conjure. All 355 tests pass.","labels":["conjure","rewrite"]}
